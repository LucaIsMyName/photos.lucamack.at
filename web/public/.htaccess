<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Set headers for permanent redirects
  <IfModule mod_headers.c>
    Header always set Cache-Control "no-cache, no-store, must-revalidate" env=REDIRECT_STATUS
  </IfModule>
  
  # Redirect old image URLs to homepage (permanent redirect)
  RewriteRule ^image/(.*)$ / [R=301,L]
  
  # Redirects for legacy routes to new /app/ routes
  RewriteRule ^map/?$ /app/map [R=301,L]
  RewriteRule ^list/?$ /app/list [R=301,L]
  RewriteRule ^timeline/?$ /app/timeline [R=301,L]
  RewriteRule ^postcard/?$ /app/postcard [R=301,L]
  RewriteRule ^statistics/?$ /app/statistics [R=301,L]
  RewriteRule ^filter/?$ /app/filter [R=301,L]

  # Gallery redirects with image path preservation
  RewriteRule ^gallery/beton-und-strukturen(/image/.*)?/?$ /gallery/wien$1 [R=301,L]
  RewriteRule ^gallery/beton-und-struktur(/image/.*)?/?$ /gallery/wien$1 [R=301,L]
  RewriteRule ^gallery/nhm(/image/.*)?/?$ /gallery/im-museum$1 [R=301,L]
  RewriteRule ^gallery/bad-ischl(/image/.*)?/?$ /gallery/im-museum$1 [R=301,L]
  RewriteRule ^gallery/kleinlobming(/image/.*)?/?$ /gallery/sonstwo-und-allfaelliges$1 [R=301,L]
  RewriteRule ^gallery/ottenstein(/image/.*)?/?$ /gallery/sonstwo-und-allfaelliges$1 [R=301,L]
  RewriteRule ^gallery/waidhofen(/image/.*)?/?$ /gallery/sonstwo-und-allfaelliges$1 [R=301,L]
  RewriteRule ^gallery/salzkammergut(/image/.*)?/?$ /gallery/im-museum$1 [R=301,L]
  RewriteRule ^gallery/baden-fahren(/image/.*)?/?$ /gallery/baden-gehen$1 [R=301,L]
  
  # SSG-aware routing: serve static HTML files generated by vite-react-ssg
  # Allow direct access to existing files and directories
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  
  # If path doesn't end with .html, try adding .html extension (for SSG routes)
  RewriteCond %{REQUEST_URI} !\.html$
  RewriteCond %{REQUEST_FILENAME}\.html -f
  RewriteRule ^(.*)$ $1.html [L]
  
  # Fallback to index.html only for client-side routes (SPA behavior)
  RewriteRule ^index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} !-l
  RewriteRule . /index.html [L]
</IfModule>
