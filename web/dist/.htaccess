<IfModule mod_rewrite.c># Enable URL rewriting
RewriteEngine On

# Redirect domain/galleryName to domain.com/gallery/galleryName
# Only if the galleryName is not already in a path with /gallery/ prefix
RewriteCond %{REQUEST_URI} !^/gallery/ [NC]
RewriteCond %{REQUEST_URI} !^/(app|css|js|images|assets|api)/ [NC]
RewriteCond %{REQUEST_URI} !^/index\.html$ [NC]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([^/]+)/?$ /gallery/$1 [R=301,L]

# Redirect domain.com/galleryName/imageName to domain.com/gallery/galleryName/image/imageName
# Only if the URL doesn't already contain /image/ and isn't already in the correct format
RewriteCond %{REQUEST_URI} !^/gallery/[^/]+/image/ [NC]
RewriteCond %{REQUEST_URI} !^/(app|css|js|images|assets|api)/ [NC]
RewriteRule ^([^/]+)/([^/]+)/?$ /gallery/$1/image/$2 [R=301,L]

# If using HTML5 history mode in a SPA, add this to handle direct URL access:
# This sends all requests that don't match an actual file or directory to index.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]
</IfModule>
