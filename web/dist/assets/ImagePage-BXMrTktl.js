import{c as P,u as D,g as U,s as y,e as S,r as _,j as e,C as i,b as c,a as x,L as M,l as N}from"./index-Bf-dxPlu.js";import{M as C,a as T}from"./scale-control-CImBRdUI.js";import{I as E}from"./Image-DO-peaWE.js";import{C as b}from"./CopyButton-C8k9cIaL.js";import{H as u}from"./Href-DK75dzyl.js";import F from"./NotFoundPage-CwIRaNIZ.js";import"./mapbox-gl-CNTiHEyl.js";import"./check-KlXGX24Q.js";const G=()=>{const r=P.c(10),{gallerySlug:d,slug:t}=D();let l;e:{if(!d||!t){l=void 0;break e}let s,g;if(r[0]!==d||r[1]!==t){let o;if(r[5]!==d?(o=m=>m.slug===d,r[5]=d,r[6]=o):o=r[6],s=U.find(o),!s){l=void 0;break e}g=s.images?.find(m=>{const w=m.filename.replace(/\.[^/.]+$/,"");return y(w)===t}),r[0]=d,r[1]=t,r[2]=s,r[3]=g,r[4]=l}else s=r[2],g=r[3],l=r[4];const f=g;if(f){let o;r[7]!==s||r[8]!==f?(o={image:f,gallery:s},r[7]=s,r[8]=f,r[9]=o):o=r[9],l=o;break e}l=void 0}return l},Q=()=>{const{theme:r}=S(),d=G();if(_.useEffect(()=>{if(d){const{image:s,gallery:g}=d,f=document.createElement("script");f.type="application/ld+json",f.id="image-structured-data";const o={"@context":"https://schema.org","@type":"ImageObject",name:s.filename,description:s.alt||`A photo from the gallery: ${g.title}`,contentUrl:`${i.url}${c(g.slug,encodeURI(s.filename.replaceAll(" ","_")),"original")}`,author:{"@type":"Person",name:i.meta.title},...s.latitude&&s.longitude&&{location:{"@type":"Place",geo:{"@type":"GeoCoordinates",latitude:s.latitude,longitude:s.longitude},...s.googleMapsUrl&&{sameAs:s.googleMapsUrl}}}};return f.innerHTML=JSON.stringify(o),document.head.appendChild(f),()=>{const m=document.getElementById("image-structured-data");m&&document.head.removeChild(m)}}},[d]),!d)return e.jsx(e.Fragment,{children:e.jsx(F,{title:"Foto nicht gefunden"})});const{image:t,gallery:l}=d,v=_.useMemo(()=>{if(!d)return[];const{image:s,gallery:g}=d,f=(n,a,h,p)=>{const A=(h-n)*(Math.PI/180),R=(p-a)*(Math.PI/180),k=Math.sin(A/2)*Math.sin(A/2)+Math.cos(n*(Math.PI/180))*Math.cos(h*(Math.PI/180))*Math.sin(R/2)*Math.sin(R/2);return 6371*(2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)))},o=new Set;o.add(s.filename);const m=[],w=U.flatMap(n=>n.images.map(a=>({...a,gallerySlug:n.slug}))).filter(n=>n.filename!==s.filename);s.latitude&&s.longitude&&w.filter(a=>!o.has(a.filename)&&a.latitude&&a.longitude).map(a=>({...a,distance:f(s.latitude,s.longitude,a.latitude,a.longitude),isNearestPick:!0})).sort((a,h)=>a.distance-h.distance).slice(0,2).forEach(a=>{m.push(a),o.add(a.filename)});const j=g.images.filter(n=>!o.has(n.filename)).map(n=>({...n,gallerySlug:g.slug,isSameGalleryPick:!0}));if(j.length>2)for(let n=j.length-1;n>0;n--){const a=Math.floor(Math.random()*(n+1));[j[n],j[a]]=[j[a],j[n]]}j.slice(0,2).forEach(n=>{m.push(n),o.add(n.filename)});const $=w.filter(n=>!o.has(n.filename));if($.length>0){for(let a=$.length-1;a>0;a--){const h=Math.floor(Math.random()*(a+1));[$[a],$[h]]=[$[h],$[a]]}$.slice(0,2).map(a=>({...a,isRandomPick:!0})).forEach(a=>{m.push(a),o.add(a.filename)})}if(m.length<6){const n=6-m.length,a=w.filter(h=>!o.has(h.filename));if(a.length>0){for(let p=a.length-1;p>0;p--){const I=Math.floor(Math.random()*(p+1));[a[p],a[I]]=[a[I],a[p]]}a.slice(0,n).map(p=>({...p,isRandomPick:!0,isAdditionalRandomPick:!0})).forEach(p=>{m.push(p),o.add(p.filename)})}}for(let n=m.length-1;n>0;n--){const a=Math.floor(Math.random()*(n+1));[m[n],m[a]]=[m[a],m[n]]}return m},[d]);return e.jsxs("div",{className:"w-full md:max-w-[var(--content-width)] p-4 md:py-8 md:px-0  md:px-8  flex flex-col items-center",children:[e.jsx("title",{children:`${t.filename.replace("_"," ").replace(".jpg","").trim()} | ${l.title} | ${i.meta.title}`}),e.jsx("meta",{name:"title",content:`${t.filename.replace("_"," ").replace(".jpg","").trim()} | ${l.title} | ${i.meta.title}`}),e.jsx("meta",{name:"description",content:`${l.title} - ${t.filename.replace(".jpg","")}`}),e.jsx("meta",{name:"image",content:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),640)}`}),e.jsx("meta",{name:"og:image",content:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),640)}`}),e.jsx("meta",{name:"og:title",content:`${t.filename} | ${l.title} | ${i.meta.title}`}),e.jsx("meta",{name:"og:description",content:`${t.alt||l.title}`}),e.jsx("meta",{name:"og:url",content:`${window.location.origin}/gallery/${l.slug}/image/${y(t.filename)}`}),e.jsxs("div",{className:"w-full max-w-4xl flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center h-auto md:h-[85vh]",children:e.jsx(E,{src:c(l.slug,encodeURI(t.filename.replaceAll(" ","_"))),alt:t.filename.replaceAll("_"," ").replace(".jpg","").trim(),width:t.width,height:t.height,sizes:"(max-width: 768px) 100vw, 1024px",className:"max-h-full h-full max-w-full object-contain"})}),e.jsxs("div",{className:"flex flex-col gap-0 w-full",children:[e.jsx("h1",{className:"text-base md:text-3xl mb-4 text-balance",children:t.filename.replaceAll("_"," ").replace(".jpg","").trim()}),e.jsxs("div",{className:`flex w-full justify-between items-center gap-4 my-4 ${i.theme.border.top} pt-8`,children:[e.jsx("div",{className:"flex justify-start items-center gap-1 text-[11px] leading-[20px]",children:e.jsxs("div",{className:x("flex-1 flex justify-between  w-full items-center gap-4  "),children:[e.jsx(M,{to:`/gallery/${l.slug}`,children:e.jsx("img",{src:c(l.slug,encodeURI(l.images[0].filename.replaceAll(" ","_")),160),alt:l.title,className:"w-16 h-16 object-cover"})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(u,{to:`/gallery/${l.slug}`,className:"text-base truncate",hasDecoration:!1,children:l.title})}),t.createDate&&N(t.createDate)&&e.jsx(u,{to:`/app/timeline?scrollTo=${N(t.createDate)?.toISOString().split("T")[0]}`,className:x("text-[11px] font-mono truncate"),children:N(t.createDate)&&new Date(N(t.createDate)).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric"})})]})]})}),e.jsx(b,{className:" min-h-4 min-w-4 sm:flex-row-reverse",iconToRight:!1,textToCopy:window.location.href,children:e.jsx("span",{className:"text-[11px] text-nowrap hidden sm:block truncate font-mono",children:"URL Kopieren"})})]}),e.jsxs("div",{className:`flex flex-col lg:flex-row-reverse gap-8 mt-4 ${i.theme.border.top} pt-4 md:pt-8`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base mb-2",children:"URLs"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[100px,1fr] gap-x-4 gap-y-3 text-sm",children:[e.jsx("div",{className:`text-[10px] tracking-wider font-mono pt-4 ${i.theme.border.top}`,children:"Original"}),e.jsxs("div",{className:x(`  flex items-center gap-2 font-mono pb-4 ${i.theme.border.bottom}`),children:[e.jsx(u,{href:c(l.slug,t.filename.replaceAll(" ","_"),"original"),hasDecoration:!1,className:x("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),"original")}`}),e.jsx(b,{className:"",textToCopy:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),"original")}`})]}),e.jsx("div",{className:"text-[10px] tracking-wider font-mono",children:"1440 px"}),e.jsxs("div",{className:x(`flex items-center gap-2 font-mono pb-4 ${i.theme.border.bottom}`),children:[e.jsx(u,{href:c(l.slug,t.filename.replaceAll(" ","_"),1440),hasDecoration:!1,className:x("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),1440)}`}),e.jsx(b,{textToCopy:window.location.href})]}),e.jsx("div",{className:"text-[10px] tracking-wider font-mono",children:"640 px"}),e.jsxs("div",{className:x(`flex items-center gap-2 font-mono pb-4 ${i.theme.border.bottom}`),children:[e.jsx(u,{href:c(l.slug,t.filename.replaceAll(" ","_"),640),hasDecoration:!1,className:x("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),640)}`}),e.jsx(b,{textToCopy:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),640)}`})]}),e.jsx("div",{className:"text-[10px] tracking-wider font-mono",children:"380 px"}),e.jsxs("div",{className:x(`flex items-center gap-2 font-mono pb-4 ${i.theme.border.bottom}`),children:[e.jsx(u,{href:c(l.slug,t.filename.replaceAll(" ","_"),380),hasDecoration:!1,className:x("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),380)}`}),e.jsx(b,{textToCopy:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),380)}`})]}),e.jsx("div",{className:"text-[10px] tracking-wider font-mono",children:"160 px"}),e.jsxs("div",{className:x(`flex items-center gap-2 font-mono pb-4 ${i.theme.border.bottom}`),children:[e.jsx(u,{href:c(l.slug,t.filename.replaceAll(" ","_"),160),hasDecoration:!1,className:x("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),160)}`}),e.jsx(b,{textToCopy:`${i.url}${c(l.slug,encodeURI(t.filename.replaceAll(" ","_")),160)}`})]})]})]}),t.latitude&&t.longitude&&e.jsxs("div",{className:"flex-1 mb-8 md:mb-4",children:[e.jsx("h2",{className:"text-base mb-2",children:"Standort & Karte"}),e.jsx("p",{className:"text-xs mb-2 font-mono text-[11px]",children:`${t.latitude.toFixed(4)}, ${t.longitude.toFixed(4)}`}),e.jsx("div",{className:"border aspect-square w-full overflow-hidden",children:e.jsx(C,{initialViewState:{latitude:t.latitude,longitude:t.longitude,zoom:12},style:{width:"100%",height:"100%"},mapStyle:r==="dark"?i.mapbox.style.dark:i.mapbox.style.light,mapboxAccessToken:i.mapbox.accessToken,scrollZoom:!0,dragPan:!1,children:e.jsx(T,{longitude:t.longitude,latitude:t.latitude,children:e.jsx("div",{children:e.jsx("div",{className:x("w-4 h-4 border border-white",r==="dark"?"bg-red-300":"bg-red-600")})})})},t.filename)}),e.jsxs("div",{className:"flex flex-wrap space-y-2 space-x-4 gap-0 mt-2",children:[e.jsx(M,{to:`/app/map?image=${y(t.filename.replace(/\.[^/.]+$/,""))}&gallery=${l.slug}`,className:x("text-sm inline-block underline underline-offset-4 inline-block ",r==="dark"?"text-white decoration-red-300 hover:text-red-300 hover:decoration-red-300":"text-black decoration-red-500 hover:text-red-600"),children:"Auf der Karte anzeigen"}),e.jsx(u,{className:"text-sm",href:`https://www.google.com/maps/search/?api=1&query=${t.latitude},${t.longitude}`,children:"Google Maps"}),e.jsx(u,{className:"text-sm",href:`http://maps.apple.com/?q=${t.latitude},${t.longitude}`,children:"Apple Maps"})]})]})]})]})]}),v.length>0&&e.jsxs("div",{className:"w-full pb-8 md:pb-0 max-w-4xl mt-8 pt-8 border-t border-neutral-500/50 border-dotted",children:[e.jsx("h2",{className:"text-base mb-4",children:"Andere Fotos"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-4",children:v.map(s=>e.jsx(M,{to:`/gallery/${s.gallerySlug}/image/${y(s.filename.replace(/\.[^/.]+$/,""))}`,className:"relative",children:e.jsx("img",{src:c(s.gallerySlug,s.filename.replaceAll(" ","_"),380),alt:s.filename.replaceAll("_"," ").replace(".jpg","").trim(),width:160,height:160,sizes:"(max-width: 768px) 50vw, 20vw",className:x("aspect-square object-cover w-full h-full",s.isRandomPick&&"")})},s.filename))})]})]})};export{Q as default};
