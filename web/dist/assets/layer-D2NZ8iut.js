import{r as c}from"./index-CTxSx3HY.js";import{b as m,d as y}from"./scale-control-BW3OWBxy.js";function d(t,e){if(!t)throw new Error(e)}let L=0;function S(t,e,a){if(t.style&&t.style._loaded){const n={...a};return delete n.id,delete n.children,t.addSource(e,n),t.getSource(e)}return null}function h(t,e,a){d(e.id===a.id,"source id changed"),d(e.type===a.type,"source type changed");let n="",o=0;for(const i in e)i!=="children"&&i!=="id"&&!y(a[i],e[i])&&(n=i,o++);if(!o)return;const l=e.type;l==="geojson"?t.setData(e.data):l==="image"?t.updateImage({url:e.url,coordinates:e.coordinates}):"setCoordinates"in t&&o===1&&n==="coordinates"?t.setCoordinates(e.coordinates):"setUrl"in t&&n==="url"?t.setUrl(e.url):"setTiles"in t&&n==="tiles"?t.setTiles(e.tiles):console.warn(`Unable to update <Source> prop: ${n}`)}function k(t){const e=c.useContext(m).map.getMap(),a=c.useRef(t),[,n]=c.useState(0),o=c.useMemo(()=>t.id||`jsx-source-${L++}`,[]);c.useEffect(()=>{if(e){const i=()=>setTimeout(()=>n(u=>u+1),0);return e.on("styledata",i),i(),()=>{if(e.off("styledata",i),e.style&&e.style._loaded&&e.getSource(o)){const u=e.getStyle()?.layers;if(u)for(const s of u)s.source===o&&e.removeLayer(s.id);e.removeSource(o)}}}},[e]);let l=e&&e.style&&e.getSource(o);return l?h(l,t,a.current):l=S(e,o,t),a.current=t,l&&c.Children.map(t.children,i=>i&&c.cloneElement(i,{source:o}))||null}function x(t,e,a,n){if(d(a.id===n.id,"layer id changed"),d(a.type===n.type,"layer type changed"),a.type==="custom"||n.type==="custom")return;const{layout:o={},paint:l={},filter:i,minzoom:u,maxzoom:s,beforeId:g}=a;if(g!==n.beforeId&&t.moveLayer(e,g),o!==n.layout){const f=n.layout||{};for(const r in o)y(o[r],f[r])||t.setLayoutProperty(e,r,o[r]);for(const r in f)o.hasOwnProperty(r)||t.setLayoutProperty(e,r,void 0)}if(l!==n.paint){const f=n.paint||{};for(const r in l)y(l[r],f[r])||t.setPaintProperty(e,r,l[r]);for(const r in f)l.hasOwnProperty(r)||t.setPaintProperty(e,r,void 0)}y(i,n.filter)||t.setFilter(e,i),(u!==n.minzoom||s!==n.maxzoom)&&t.setLayerZoomRange(e,u,s)}function C(t,e,a){if(t.style&&t.style._loaded&&(!("source"in a)||t.getSource(a.source))){const n={...a,id:e};delete n.beforeId,t.addLayer(n,a.beforeId)}}let b=0;function I(t){const e=c.useContext(m).map.getMap(),a=c.useRef(t),[,n]=c.useState(0),o=c.useMemo(()=>t.id||`jsx-layer-${b++}`,[]);if(c.useEffect(()=>{if(e){const i=()=>n(u=>u+1);return e.on("styledata",i),i(),()=>{e.off("styledata",i),e.style&&e.style._loaded&&e.getLayer(o)&&e.removeLayer(o)}}},[e]),e&&e.style&&e.getLayer(o))try{x(e,o,t,a.current)}catch(i){console.warn(i)}else C(e,o,t);return a.current=t,null}export{I as L,k as S};
