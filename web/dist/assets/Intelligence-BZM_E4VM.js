import{h as X,c as Q,u as U,r as E,j as i,L as H,s as Z,g as B,C as ee}from"./index-Ba8CfoLB.js";import{M as te}from"./map-pin-DlrXuVZ6.js";import{E as se}from"./eye-DzlywgI2.js";import{S as ae}from"./SeoHead-aJOOPHCb.js";import"./mapbox-gl-CNTiHEyl.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ne=X("calendar",re),le=c=>{const e=Q.c(44),{onApiKeySet:t}=c,{theme:a}=U(),[s,l]=E.useState(""),[r,n]=E.useState(!1);let o;e[0]!==s||e[1]!==t?(o=async()=>{if(s.trim()){if(n(!0),!s.startsWith("AIza")){alert('Invalid API key format. Google Vision API keys should start with "AIza"'),n(!1);return}localStorage.setItem("google-vision-api-key",s.trim()),setTimeout(()=>{t(s.trim()),n(!1)},500)}},e[0]=s,e[1]=t,e[2]=o):o=e[2];const h=o,u=`max-w-md mx-auto p-8 ${a==="dark"?"bg-black text-white":"bg-white text-black"} border ${a==="dark"?"border-white":"border-black"}`,d=`text-xl font-semibold mb-6 text-center ${a==="dark"?"text-white":"text-black"}`;let m;e[3]!==d?(m=i.jsx("h2",{className:d,children:"Google Vision API Key Required"}),e[3]=d,e[4]=m):m=e[4];const p=`block text-sm font-medium mb-2 ${a==="dark"?"text-white":"text-black"}`;let g;e[5]!==p?(g=i.jsx("label",{htmlFor:"apiKey",className:p,children:"API Key"}),e[5]=p,e[6]=g):g=e[6];let v;e[7]===Symbol.for("react.memo_cache_sentinel")?(v=O=>l(O.target.value),e[7]=v):v=e[7];const j=`w-full px-3 py-2 border focus:outline-none ${a==="dark"?"border-white bg-black text-white focus:border-red-500":"border-black bg-white text-black focus:border-red-500"}`;let b;e[8]!==s||e[9]!==j?(b=i.jsx("input",{type:"password",id:"apiKey",value:s,onChange:v,placeholder:"Enter your Google Vision API key",className:j}),e[8]=s,e[9]=j,e[10]=b):b=e[10];let x;e[11]!==g||e[12]!==b?(x=i.jsxs("div",{className:"mb-6",children:[g,b]}),e[11]=g,e[12]=b,e[13]=x):x=e[13];let y;e[14]!==s||e[15]!==r?(y=!s.trim()||r,e[14]=s,e[15]=r,e[16]=y):y=e[16];const _=`w-full font-medium py-2 px-4 transition-colors ${!s.trim()||r?a==="dark"?"bg-gray-800 text-gray-500":"bg-gray-200 text-gray-400":"bg-red-600 hover:bg-red-700 text-white"}`,D=r?"Validating...":"Set API Key";let w;e[17]!==h||e[18]!==y||e[19]!==_||e[20]!==D?(w=i.jsx("button",{onClick:h,disabled:y,className:_,children:D}),e[17]=h,e[18]=y,e[19]=_,e[20]=D,e[21]=w):w=e[21];const k=`mt-8 p-4 border ${a==="dark"?"border-white":"border-black"}`,C=`text-sm font-medium mb-2 ${a==="dark"?"text-white":"text-black"}`;let S;e[22]!==C?(S=i.jsx("h3",{className:C,children:"How to get your API key:"}),e[22]=C,e[23]=S):S=e[23];const M=`text-sm space-y-1 list-decimal list-inside ${a==="dark"?"text-white":"text-black"}`;let A,P,z,K,L;e[24]===Symbol.for("react.memo_cache_sentinel")?(A=i.jsxs("li",{children:["Go to ",i.jsx("a",{href:"https://console.cloud.google.com/",target:"_blank",rel:"noopener noreferrer",className:"underline text-red-600",children:"Google Cloud Console"})]}),P=i.jsx("li",{children:"Create a new project or select an existing one"}),z=i.jsx("li",{children:'Enable the "Cloud Vision API"'}),K=i.jsx("li",{children:'Go to "Credentials" and create an API key'}),L=i.jsx("li",{children:'Restrict the key to "Cloud Vision API" only'}),e[24]=A,e[25]=P,e[26]=z,e[27]=K,e[28]=L):(A=e[24],P=e[25],z=e[26],K=e[27],L=e[28]);let $;e[29]!==M?($=i.jsxs("ol",{className:M,children:[A,P,z,K,L]}),e[29]=M,e[30]=$):$=e[30];const F=`text-xs mt-2 ${a==="dark"?"text-gray-300":"text-gray-600"}`;let I;e[31]!==F?(I=i.jsx("p",{className:F,children:"Your API key is stored locally and never sent to our servers."}),e[31]=F,e[32]=I):I=e[32];let N;e[33]!==k||e[34]!==S||e[35]!==$||e[36]!==I?(N=i.jsxs("div",{className:k,children:[S,$,I]}),e[33]=k,e[34]=S,e[35]=$,e[36]=I,e[37]=N):N=e[37];let R;return e[38]!==x||e[39]!==w||e[40]!==u||e[41]!==N||e[42]!==m?(R=i.jsxs("div",{className:u,children:[m,x,w,N]}),e[38]=x,e[39]=w,e[40]=u,e[41]=N,e[42]=m,e[43]=R):R=e[43],R},ie=(c,e,t="original")=>{const a=encodeURI(e.replaceAll(" ","_"));if(t==="original")return`/content/galleries/${c}/${a}`;const s=e.split(".").pop()?.toLowerCase(),l=e.replace(/\.[^/.]+$/,"").replaceAll(" ","_");return`/content/galleries/${c}/${l}-${t}w.${s}`},oe=c=>{const e=Q.c(18),{images:t,message:a}=c,{theme:s}=U(),l=ce;if(t.length===0){const u=`text-center py-8 ${s==="light"?"text-gray-500":"text-gray-400"}`;let d;e[0]!==a?(d=i.jsx("p",{children:a}),e[0]=a,e[1]=d):d=e[1];let m;return e[2]!==u||e[3]!==d?(m=i.jsx("div",{className:u,children:d}),e[2]=u,e[3]=d,e[4]=m):m=e[4],m}let r;e[5]!==a||e[6]!==s?(r=a&&i.jsx("div",{className:"p-3 border ",children:i.jsx("p",{className:"font-medium",children:a})}),e[5]=a,e[6]=s,e[7]=r):r=e[7];let n;if(e[8]!==t||e[9]!==s){let u;e[11]!==s?(u=(d,m)=>i.jsxs("div",{className:`border overflow-hidden ${s==="dark"?"bg-black border-white":"bg-white border-black"}`,children:[i.jsx(H,{to:`/gallery/${d.gallerySlug}/image/${Z(d.filename.replace(/\.[^/.]+$/,""))}`,children:i.jsx("div",{className:"aspect-square overflow-hidden",children:i.jsx("img",{src:ie(d.gallerySlug,d.filename,"380"),alt:d.filename,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"})})}),i.jsxs("div",{className:"p-3 space-y-2",children:[i.jsx("h3",{className:`font-medium text-sm truncate ${s==="dark"?"text-white":"text-black"}`,children:d.filename.replace(/\.[^/.]+$/,"")}),i.jsx(H,{to:`/gallery/${d.gallerySlug}`,className:`text-xs underline ${s==="dark"?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-700"}`,children:d.galleryTitle}),i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[d.createDate&&i.jsxs("div",{className:`flex items-center gap-1 ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:[i.jsx(ne,{size:12}),l(d.createDate)]}),d.latitude&&d.longitude&&i.jsxs("div",{className:`flex items-center gap-1 ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:[i.jsx(te,{size:12}),"GPS"]})]}),d.aiAnalysis&&d.aiAnalysis.labels.length>0&&i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:`flex items-center gap-1 text-xs ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:[i.jsx(se,{size:12}),"AI erkannt:"]}),i.jsx("div",{className:"flex flex-wrap gap-1",children:d.aiAnalysis.labels.slice(0,3).map((p,g)=>i.jsx("span",{className:`px-2 py-1 text-xs border ${s==="dark"?"border-white text-white":"border-black text-black"}`,children:p.description},g))})]})]})]},`${d.gallerySlug}-${d.filename}-${m}`),e[11]=s,e[12]=u):u=e[12],n=t.map(u),e[8]=t,e[9]=s,e[10]=n}else n=e[10];let o;e[13]!==n?(o=i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n}),e[13]=n,e[14]=o):o=e[14];let h;return e[15]!==r||e[16]!==o?(h=i.jsxs("div",{className:"space-y-4",children:[r,o]}),e[15]=r,e[16]=o,e[17]=h):h=e[17],h};function ce(c){return new Date(c).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}const de=c=>{const e=Q.c(58),{messages:t,onSendMessage:a,isLoading:s,apiKey:l,onApiKeyChange:r}=c,{theme:n}=U(),[o,h]=E.useState(""),u=E.useRef(null),d=E.useRef(null);let m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m=()=>{u.current?.scrollIntoView({behavior:"smooth"})},e[0]=m):m=e[0];let p;e[1]!==s||e[2]!==t?(p=[t,s],e[1]=s,e[2]=t,e[3]=p):p=e[3],E.useEffect(m,p);let g,v;e[4]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{d.current?.focus()},v=[],e[4]=g,e[5]=v):(g=e[4],v=e[5]),E.useEffect(g,v);let j;e[6]!==o||e[7]!==s||e[8]!==a?(j=f=>{f.preventDefault(),!(!o.trim()||s)&&(a(o.trim()),h(""))},e[6]=o,e[7]=s,e[8]=a,e[9]=j):j=e[9];const b=j;let x;e[10]===Symbol.for("react.memo_cache_sentinel")?(x=["Show me photos from last week","I want to see pictures with trees and buildings","Can you find 5 random images with people?","What photos do I have from Vienna?","Show me beautiful landscape photos from this year"],e[10]=x):x=e[10];const y=x;let _;e[11]!==a?(_=f=>{h(f),a(f)},e[11]=a,e[12]=_):_=e[12];const D=_,w=`flex flex-col h-full w-full ${n==="dark"?"bg-black text-white":"bg-white text-black"}`;let k;e[13]!==l||e[14]!==r?(k=()=>{const f=prompt("Enter new Google Vision API key:",l);f!==null&&(f.trim()?(localStorage.setItem("google-vision-api-key",f.trim()),r(f.trim())):(localStorage.removeItem("google-vision-api-key"),r("")))},e[13]=l,e[14]=r,e[15]=k):k=e[15];const C=`px-3 py-1 text-xs border ${n==="dark"?"border-white text-white hover:bg-white hover:text-black":"border-black text-black hover:bg-black hover:text-white"} transition-colors`;let S;e[16]!==C||e[17]!==k?(S=i.jsx("div",{className:"absolute top-4 right-4 z-10",children:i.jsx("button",{onClick:k,className:C,children:"Change API Key"})}),e[16]=C,e[17]=k,e[18]=S):S=e[18];let M;e[19]!==D||e[20]!==t.length||e[21]!==n?(M=t.length===0&&i.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-w-2xl mx-auto",children:y.map((f,T)=>i.jsx("button",{onClick:()=>D(f),className:`p-3 text-sm text-left border transition-colors ${n==="dark"?"border-white text-white hover:bg-white hover:text-black":"border-black text-black hover:bg-black hover:text-white"}`,children:f},T))})}),e[19]=D,e[20]=t.length,e[21]=n,e[22]=M):M=e[22];let A;if(e[23]!==t||e[24]!==n){let f;e[26]!==n?(f=(T,J)=>i.jsx("div",{className:`flex ${T.type==="user"?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 ${T.type==="user"?"bg-red-600 text-white":n==="dark"?"bg-white text-black":"bg-black text-white"}`,children:[i.jsx("p",{className:"text-sm",children:T.content}),T.results&&T.results.length>0&&i.jsx("div",{className:"mt-3",children:i.jsx(oe,{images:T.results,message:""})})]})},J),e[26]=n,e[27]=f):f=e[27],A=t.map(f),e[23]=t,e[24]=n,e[25]=A}else A=e[25];let P;e[28]===Symbol.for("react.memo_cache_sentinel")?(P=i.jsx("div",{ref:u}),e[28]=P):P=e[28];let z;e[29]!==M||e[30]!==A?(z=i.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",ref:u,children:[M,A,P]}),e[29]=M,e[30]=A,e[31]=z):z=e[31];const K=`border-t p-4 ${n==="dark"?"border-white":"border-black"}`;let L;e[32]===Symbol.for("react.memo_cache_sentinel")?(L=f=>h(f.target.value),e[32]=L):L=e[32];let $;e[33]!==b?($=f=>f.key==="Enter"&&b(f),e[33]=b,e[34]=$):$=e[34];const F=`flex-1 px-3 py-2 border focus:outline-none ${n==="dark"?"border-white bg-black text-white focus:border-red-500":"border-black bg-white text-black focus:border-red-500"}`;let I;e[35]!==o||e[36]!==s||e[37]!==$||e[38]!==F?(I=i.jsx("input",{ref:d,type:"text",value:o,onChange:L,onKeyPress:$,placeholder:"Ask about your photos...",disabled:s,className:F}),e[35]=o,e[36]=s,e[37]=$,e[38]=F,e[39]=I):I=e[39];let N;e[40]!==b?(N=f=>b(f),e[40]=b,e[41]=N):N=e[41];const R=!o.trim()||s,O=`px-4 py-2 transition-colors ${!o.trim()||s?n==="dark"?"bg-gray-800 text-gray-500":"bg-gray-200 text-gray-400":"bg-red-600 hover:bg-red-700 text-white"}`,W=s?"Sending...":"Send";let G;e[42]!==N||e[43]!==R||e[44]!==O||e[45]!==W?(G=i.jsx("button",{onClick:N,disabled:R,className:O,children:W}),e[42]=N,e[43]=R,e[44]=O,e[45]=W,e[46]=G):G=e[46];let V;e[47]!==I||e[48]!==G?(V=i.jsxs("div",{className:"flex space-x-2",children:[I,G]}),e[47]=I,e[48]=G,e[49]=V):V=e[49];let Y;e[50]!==K||e[51]!==V?(Y=i.jsx("div",{className:K,children:V}),e[50]=K,e[51]=V,e[52]=Y):Y=e[52];let q;return e[53]!==S||e[54]!==z||e[55]!==Y||e[56]!==w?(q=i.jsxs("div",{className:w,children:[S,z,Y]}),e[53]=S,e[54]=z,e[55]=Y,e[56]=w,e[57]=q):q=e[57],q};class he{apiKey;baseUrl="https://vision.googleapis.com/v1/images:annotate";constructor(e){this.apiKey=e}async analyzeImage(e){try{const t=await fetch(`${this.baseUrl}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requests:[{image:{source:{imageUri:e}},features:[{type:"LABEL_DETECTION",maxResults:10},{type:"TEXT_DETECTION",maxResults:1}]}]})});if(!t.ok)throw new Error(`API request failed: ${t.status} ${t.statusText}`);const s=(await t.json()).responses[0];if(s.error)throw new Error(`Vision API error: ${s.error.message}`);return{labels:s.labelAnnotations?.map(l=>({description:l.description.toLowerCase(),confidence:l.score}))||[],text:s.textAnnotations?.[0]?.description||void 0}}catch(t){return console.error("Error analyzing image:",t),{labels:[],error:t instanceof Error?t.message:"Unknown error occurred"}}}async analyzeImages(e){const a=[];for(let s=0;s<e.length;s+=5){const r=e.slice(s,s+5).map(o=>this.analyzeImage(o)),n=await Promise.all(r);a.push(...n),s+5<e.length&&await new Promise(o=>setTimeout(o,100))}return a}}class me{visionService;analysisCache=new Map;constructor(e){this.visionService=new he(e),this.loadCachedAnalysis()}loadCachedAnalysis(){try{const e=localStorage.getItem("vision-analysis-cache");if(e){const t=JSON.parse(e);this.analysisCache=new Map(t)}}catch(e){console.error("Error loading cached analysis:",e)}}saveCachedAnalysis(){try{const e=Array.from(this.analysisCache.entries());localStorage.setItem("vision-analysis-cache",JSON.stringify(e))}catch(e){console.error("Error saving cached analysis:",e)}}async processQuery(e){const t=this.analyzeIntent(e),a=this.parseNaturalLanguage(e,t);let l=[...B.flatMap(r=>r.images.map(n=>({...n,gallerySlug:r.slug,galleryTitle:r.title})))];if(a.dateRange&&(l=l.filter(r=>{if(!r.createDate)return!1;const n=new Date(r.createDate);return n>=a.dateRange.start&&n<=a.dateRange.end})),a.location){const r=a.location.toLowerCase();l=l.filter(n=>{const o=B.find(h=>h.slug===n.gallerySlug);return o?.tags?o.tags.some(h=>h.toLowerCase().includes(r)):o?.title.toLowerCase().includes(r)||!1})}return a.galleryNames&&a.galleryNames.length>0&&(l=l.filter(r=>{const n=B.find(o=>o.slug===r.gallerySlug);return a.galleryNames.some(o=>n?.title.toLowerCase().includes(o)||n?.slug.toLowerCase().includes(o))})),a.content&&a.content.length>0&&(l=await this.filterByContent(l,a.content)),a.random&&a.limit?l=this.getRandomItems(l,a.limit):a.limit&&(l=l.slice(0,a.limit)),{type:"images",items:l,message:this.generateResponseMessage(l.length,a,e),totalFound:l.length}}analyzeIntent(e){const t=e.toLowerCase(),a=[/\b(find|search|look for|show me|get|where|what|which|can you find|i want to see)\b/,/\b(suche|finde|zeige|wo|was|welche|kannst du finden|ich möchte sehen|ich will sehen|zeig mir)\b/],s=[/\b(browse|explore|see|view|display|all|give me)\b/,/\b(durchsuchen|erkunden|ansehen|alle|anzeigen|gib mir|lass mich sehen)\b/],l=[/\b(filter|only|just|exclude|without)\b/,/\b(filtern|nur|ohne|ausschließen)\b/];let r={type:"search",confidence:.5,entities:{}};return a.some(n=>n.test(t))?(r.type="search",r.confidence=.8):s.some(n=>n.test(t))?(r.type="browse",r.confidence=.7):l.some(n=>n.test(t))&&(r.type="filter",r.confidence=.7),r.entities=this.extractEntities(e),r}extractEntities(e){const t={},a=e.toLowerCase();return t.dates=this.extractDates(e),t.locations=this.extractLocations(a),t.objects=this.extractObjects(a),t.galleries=this.extractGalleries(a),t.quantities=this.extractQuantities(a),t.modifiers=this.extractModifiers(a),t}extractDates(e){const t=[],a=e.toLowerCase();return[{pattern:/\b(today|heute)\b/,value:"today"},{pattern:/\b(yesterday|gestern)\b/,value:"yesterday"},{pattern:/\b(last week|letzte woche|vergangene woche)\b/,value:"last_week"},{pattern:/\b(last month|letzten monat|vergangenen monat)\b/,value:"last_month"},{pattern:/\b(last year|letztes jahr|vergangenes jahr)\b/,value:"last_year"},{pattern:/\b(this week|diese woche)\b/,value:"this_week"},{pattern:/\b(this month|diesen monat)\b/,value:"this_month"},{pattern:/\b(this year|dieses jahr)\b/,value:"this_year"},{pattern:/\b(recent|recently|kürzlich|neulich)\b/,value:"last_week"}].forEach(({pattern:r,value:n})=>{r.test(a)&&t.push(n)}),[/(\d{1,2})[.\/\s]+(\d{1,2})[.\/\s]+(\d{4})/g,/(\d{1,2})[.\/\s]+(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)[.\/\s]*(\d{4})/gi,/(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)\s+(\d{4})/gi].forEach(r=>{[...e.matchAll(r)].forEach(o=>{t.push(o[0])})}),t}extractLocations(e){const t=[];["wien","vienna","salzburg","burghausen","österreich","austria","deutschland","germany","schweiz","swiss","zürich","zurich","berlin","karlsruhe","bern","munich","münchen","innsbruck"].forEach(r=>{e.includes(r)&&t.push(r)});const s=/\b(?:in|at|from|aus|von|bei)\s+([a-zA-ZäöüÄÖÜß\s]+?)\b/gi;return[...e.matchAll(s)].forEach(r=>{const n=r[1].trim();n.length>2&&t.push(n)}),t}extractObjects(e){const t=[];return Object.entries({tree:["tree","trees","baum","bäume"],flower:["flower","flowers","blume","blumen"],sky:["sky","himmel","clouds","wolken"],water:["water","wasser","sea","meer","lake","see"],mountain:["mountain","mountains","berg","berge"],forest:["forest","wald","woods"],building:["building","buildings","haus","häuser","gebäude"],bridge:["bridge","brücke"],church:["church","kirche"],castle:["castle","schloss"],car:["car","cars","auto","autos"],train:["train","zug","trains","züge"],bike:["bike","bicycle","fahrrad"],person:["person","people","menschen","man","woman","child"],animal:["animal","animals","tier","tiere","dog","cat","bird"],table:["table","tables","tisch","tische"],chair:["chair","chairs","stuhl","stühle"],lamp:["lamp","lamps","lampe","lampen"],glass:["glass","glasses","glas","gläser"]}).forEach(([s,l])=>{l.forEach(r=>{new RegExp(`\\b${r}\\b`,"i").test(e)&&t.push(s)})}),[...new Set(t)]}extractGalleries(e){const t=[],a=/["']([^"']+)["']/g;return[...e.matchAll(a)].forEach(r=>{t.push(r[1])}),["öffis","arsenal","wien"].forEach(r=>{e.includes(r)&&t.push(r)}),t}extractQuantities(e){const t=[],a=/\b(\d+)\b/g;return[...e.matchAll(a)].forEach(l=>{const r=parseInt(l[1]);r>0&&r<1e3&&t.push(r)}),t}extractModifiers(e){const t=[];return[{pattern:/\b(random|zufällig)\b/i,value:"random"},{pattern:/\b(recent|newest|latest|neueste)\b/i,value:"recent"},{pattern:/\b(old|oldest|älteste)\b/i,value:"oldest"},{pattern:/\b(best|favorite|lieblings)\b/i,value:"best"}].forEach(({pattern:s,value:l})=>{s.test(e)&&t.push(l)}),t}parseNaturalLanguage(e,t){const a={intent:t.type,confidence:t.confidence};return t.entities.dates&&t.entities.dates.length>0&&(a.dateRange=this.processDates(t.entities.dates)),t.entities.locations&&t.entities.locations.length>0&&(a.location=t.entities.locations[0]),t.entities.objects&&t.entities.objects.length>0&&(a.content=t.entities.objects),t.entities.galleries&&t.entities.galleries.length>0&&(a.galleryNames=t.entities.galleries),t.entities.quantities&&t.entities.quantities.length>0&&(a.limit=t.entities.quantities[0]),t.entities.modifiers&&t.entities.modifiers.includes("random")&&(a.random=!0),a}processDates(e){const t=new Date;for(const a of e)switch(a){case"today":return{start:new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0),end:new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59)};case"yesterday":const s=new Date(t);return s.setDate(s.getDate()-1),{start:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0),end:new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59)};case"last_week":const l=new Date(t);return l.setDate(l.getDate()-7),l.setHours(0,0,0,0),{start:l,end:t};case"this_week":const r=new Date(t);return r.setDate(r.getDate()-t.getDay()),r.setHours(0,0,0,0),{start:r,end:t};case"last_month":const n=new Date(t);return n.setMonth(n.getMonth()-1),n.setDate(1),n.setHours(0,0,0,0),{start:n,end:t};case"this_month":return{start:new Date(t.getFullYear(),t.getMonth(),1,0,0,0),end:t};case"last_year":const h=new Date(t);return h.setFullYear(h.getFullYear()-1),h.setMonth(0),h.setDate(1),h.setHours(0,0,0,0),{start:h,end:t};case"this_year":return{start:new Date(t.getFullYear(),0,1,0,0,0),end:t};default:const d=this.parseSpecificDate(a);if(d)return d}}parseSpecificDate(e){const t=[/^(\d{1,2})[.\/](\d{1,2})[.\/](\d{4})$/,/^(\d{1,2})\s+(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)\s+(\d{4})$/i,/^(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)\s+(\d{4})$/i];for(const a of t){const s=e.match(a);if(s)try{let l;if(a.source.includes("januar")){const r={januar:0,februar:1,märz:2,april:3,mai:4,juni:5,juli:6,august:7,september:8,oktober:9,november:10,dezember:11};if(s[3]){const n=parseInt(s[1]),o=r[s[2].toLowerCase()],h=parseInt(s[3]);l=new Date(h,o,n)}else{const n=r[s[1].toLowerCase()],o=parseInt(s[2]);return{start:new Date(o,n,1),end:new Date(o,n+1,0,23,59,59)}}}else{const r=parseInt(s[1]),n=parseInt(s[2])-1,o=parseInt(s[3]);l=new Date(o,n,r)}return{start:new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0),end:new Date(l.getFullYear(),l.getMonth(),l.getDate(),23,59,59)}}catch{continue}}}async filterByContent(e,t){const a=[],l=e.slice(0,50);for(const r of l){const n=`${r.gallerySlug}/${r.filename}`;let o=this.analysisCache.get(n);if(!o)try{const h=`https://photos.lucamack.at/content/galleries/${r.gallerySlug}/${encodeURI(r.filename.replaceAll(" ","_"))}`;if(o=await this.visionService.analyzeImage(h),!o.error)this.analysisCache.set(n,o),this.saveCachedAnalysis();else{this.analysisCache.set(n,{labels:[],error:o.error});continue}}catch(h){console.error(`Failed to analyze image ${n}:`,h),this.analysisCache.set(n,{labels:[],error:"Analysis failed"});continue}o.error||o&&o.labels&&t.some(u=>o.labels.some(d=>{const m=d.description.toLowerCase(),p=this.translateContent(m),g=u.toLowerCase();return d.confidence>.5&&(m===g||p===g||m.includes(g)||p.includes(g)||g.includes(m)||g.includes(p))}))&&a.push({...r,aiAnalysis:o})}return a}translateContent(e){return{tree:"baum",building:"haus",house:"haus",car:"auto",vehicle:"auto",person:"person",people:"menschen",human:"mensch",sky:"himmel",water:"wasser",flower:"blume",plant:"pflanze",animal:"tier",dog:"hund",cat:"katze",bird:"vogel",food:"essen",table:"tisch",chair:"stuhl",window:"fenster",door:"tür",street:"straße",road:"straße",bridge:"brücke",mountain:"berg",forest:"wald",lake:"see",river:"fluss",baum:"tree",haus:"building",auto:"car",mensch:"person",menschen:"people",himmel:"sky",wasser:"water",blume:"flower"}[e.toLowerCase()]||e}getRandomItems(e,t){return[...e].sort(()=>.5-Math.random()).slice(0,t)}generateResponseMessage(e,t,a){const s=/\b(zeige|finde|suche|bilder|fotos|aus|von|mit|der|die|das)\b/i.test(a);if(e===0)return s?`Keine Bilder gefunden für "${a}". Versuche eine andere Suchanfrage.`:`No images found for "${a}". Try a different search query.`;let l;if(s){if(l=`${e} Bild${e===1?"":"er"} gefunden`,t.dateRange){const r=t.dateRange.start.toLocaleDateString("de-DE");l+=` vom ${r}`}t.location&&(l+=` aus ${t.location}`),t.content&&t.content.length>0&&(l+=` mit ${t.content.join(", ")}`),t.galleryNames&&t.galleryNames.length>0&&(l+=` aus der "${t.galleryNames.join('", "')}" Galerie`)}else{if(l=`Found ${e} image${e===1?"":"s"}`,t.dateRange){const r=t.dateRange.start.toLocaleDateString("en-US");l+=` from ${r}`}t.location&&(l+=` from ${t.location}`),t.content&&t.content.length>0&&(l+=` with ${t.content.join(", ")}`),t.galleryNames&&t.galleryNames.length>0&&(l+=` from "${t.galleryNames.join('", "')}" gallery`)}return l+"."}}const ye=()=>{const c=Q.c(15),{theme:e}=U(),[t,a]=E.useState("");let s;c[0]===Symbol.for("react.memo_cache_sentinel")?(s=[],c[0]=s):s=c[0];const[l,r]=E.useState(s),[n,o]=E.useState(!1);let h,u;c[1]===Symbol.for("react.memo_cache_sentinel")?(h=()=>{const y=localStorage.getItem("google-vision-api-key");y&&a(y)},u=[],c[1]=h,c[2]=u):(h=c[1],u=c[2]),E.useEffect(h,u);let d;c[3]===Symbol.for("react.memo_cache_sentinel")?(d=y=>{a(y),y?localStorage.setItem("google-vision-api-key",y):localStorage.removeItem("google-vision-api-key")},c[3]=d):d=c[3];const m=d;let p;c[4]!==t?(p=async y=>{if(!t){alert("Please enter your Google Vision API key first.");return}const _={type:"user",content:y,timestamp:new Date};r(D=>[...D,_]),o(!0);try{const w=await new me(t).processQuery(y),k={type:"ai",content:w.message,timestamp:new Date,results:w.items};r(C=>[...C,k]),o(!1)}catch(D){console.error("Error processing message:",D);const k={type:"ai",content:"Sorry, there was an error processing your request. Please try again.",timestamp:new Date};r(C=>[...C,k]),o(!1)}},c[4]=t,c[5]=p):p=c[5];const g=p,v=`w-full h-full md:h-screen relative overflow-hidden ${e==="dark"?"bg-black text-white":"bg-white text-black"}`;let j;c[6]===Symbol.for("react.memo_cache_sentinel")?(j=i.jsx(ae,{title:`KI Foto Chat | ${ee.meta.title}`,description:"Chatte mit einem KI über alle Bilder auf dieser Website",noIndex:!0}),c[6]=j):j=c[6];let b;c[7]!==t||c[8]!==g||c[9]!==n||c[10]!==l?(b=t?i.jsx(de,{messages:l,onSendMessage:g,isLoading:n,apiKey:t,onApiKeyChange:m}):i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsx(le,{onApiKeySet:a})}),c[7]=t,c[8]=g,c[9]=n,c[10]=l,c[11]=b):b=c[11];let x;return c[12]!==v||c[13]!==b?(x=i.jsxs("div",{className:v,children:[j,b]}),c[12]=v,c[13]=b,c[14]=x):x=c[14],x};export{ye as default};
