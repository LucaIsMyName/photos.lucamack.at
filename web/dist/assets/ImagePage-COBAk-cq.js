import{c as C,u as T,g as w,s as y,e as P,r as D,j as e,C as s,b as o,a as m,L as v,l as b}from"./index-BZ2qpZQh.js";import{M as E,a as L}from"./scale-control-BLn8_De4.js";import{I as q}from"./Image-Dnmj0RUF.js";import{C as j}from"./CopyButton-Bia5m_hJ.js";import{H as f}from"./Href-4htwgfLR.js";import F from"./NotFoundPage-ChvDY7cQ.js";import"./mapbox-gl-CNTiHEyl.js";import"./check-CMcVtt1o.js";const G=()=>{const i=C.c(10),{gallerySlug:c,slug:l}=T();let t;e:{if(!c||!l){t=void 0;break e}let a,p;if(i[0]!==c||i[1]!==l){let d;if(i[5]!==c?(d=g=>g.slug===c,i[5]=c,i[6]=d):d=i[6],a=w.find(d),!a){t=void 0;break e}p=a.images?.find(g=>{const u=g.filename.replace(/\.[^/.]+$/,"");return y(u)===l}),i[0]=c,i[1]=l,i[2]=a,i[3]=p,i[4]=t}else a=i[2],p=i[3],t=i[4];const x=p;if(x){let d;i[7]!==a||i[8]!==x?(d={image:x,gallery:a},i[7]=a,i[8]=x,i[9]=d):d=i[9],t=d;break e}t=void 0}return t},Y=()=>{const{theme:i}=P(),c=G();if(D.useEffect(()=>{if(c){const{image:a,gallery:p}=c,x=document.createElement("script");x.type="application/ld+json",x.id="image-structured-data";const d={"@context":"https://schema.org","@type":"ImageObject",name:a.filename,description:a.alt||`A photo from the gallery: ${p.title}`,contentUrl:`${s.url}${o(p.slug,encodeURI(a.filename.replaceAll(" ","_")),"original")}`,author:{"@type":"Person",name:s.meta.title},...a.latitude&&a.longitude&&{location:{"@type":"Place",geo:{"@type":"GeoCoordinates",latitude:a.latitude,longitude:a.longitude},...a.googleMapsUrl&&{sameAs:a.googleMapsUrl}}}};return x.innerHTML=JSON.stringify(d),document.head.appendChild(x),()=>{const g=document.getElementById("image-structured-data");g&&document.head.removeChild(g)}}},[c]),!c)return e.jsx(e.Fragment,{children:e.jsx(F,{title:"Foto nicht gefunden"})});const{image:l,gallery:t}=c,N=D.useMemo(()=>{if(!c)return[];const{image:a,gallery:p}=c;let x=[];if(a.latitude&&a.longitude){const n=(r,$,M,S)=>{const R=(M-r)*(Math.PI/180),k=(S-$)*(Math.PI/180),_=Math.sin(R/2)*Math.sin(R/2)+Math.cos(r*(Math.PI/180))*Math.cos(M*(Math.PI/180))*Math.sin(k/2)*Math.sin(k/2);return 6371*(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)))};x=w.flatMap(r=>r.images.map($=>({...$,gallerySlug:r.slug}))).filter(r=>r.filename!==a.filename&&r.latitude&&r.longitude).map(r=>({...r,distance:n(a.latitude,a.longitude,r.latitude,r.longitude)})).sort((r,$)=>r.distance-$.distance)}let d=p.images.filter(n=>n.filename!==a.filename).map(n=>({...n,gallerySlug:p.slug}));const g=w.filter(n=>n.slug!==p.slug).flatMap(n=>n.images.map(r=>({...r,gallerySlug:n.slug}))).filter(n=>n.filename!==a.filename),u=g.length>0?g:w.flatMap(n=>n.images.map(r=>({...r,gallerySlug:n.slug}))).filter(n=>n.filename!==a.filename);let h=null;if(u.length>0){const n=new Date().getTime(),r=Math.floor((n%u.length+u.length)%u.length);h={...u[r],isRandomPick:!0},console.log("RANDOM IMAGE SELECTED:",h.filename,"from gallery:",h.gallerySlug)}const A=[...x,...d],U=h?A.filter(n=>n.filename!==h.filename):A,I=Array.from(new Map(U.map(n=>[n.filename,n])).values()).slice(0,5);return h&&I.push(h),I},[c]);return e.jsxs("div",{className:"w-full md:max-w-[var(--content-width)] p-4 md:py-8 md:px-0  md:px-8  flex flex-col items-center",children:[e.jsx("title",{children:`${l.filename.replace("_"," ").replace(".jpg","").trim()} | ${t.title} | ${s.meta.title}`}),e.jsx("meta",{name:"title",content:`${l.filename.replace("_"," ").replace(".jpg","").trim()} | ${t.title} | ${s.meta.title}`}),e.jsx("meta",{name:"description",content:`${t.title} - ${l.filename.replace(".jpg","")}`}),e.jsx("meta",{name:"image",content:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),640)}`}),e.jsx("meta",{name:"og:image",content:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),640)}`}),e.jsx("meta",{name:"og:title",content:`${l.filename} | ${t.title} | ${s.meta.title}`}),e.jsx("meta",{name:"og:description",content:`${l.alt||t.title}`}),e.jsx("meta",{name:"og:url",content:`${window.location.origin}/gallery/${t.slug}/image/${y(l.filename)}`}),e.jsxs("div",{className:"w-full max-w-4xl flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center h-auto md:h-[85vh]",children:e.jsx(q,{src:o(t.slug,encodeURI(l.filename.replaceAll(" ","_"))),alt:l.filename.replaceAll("_"," ").replace(".jpg","").trim(),width:l.width,height:l.height,sizes:"(max-width: 768px) 100vw, 1024px",className:"max-h-full h-full max-w-full object-contain"})}),e.jsxs("div",{className:"flex flex-col gap-0 w-full",children:[e.jsx("h1",{className:"text-base md:text-3xl mb-4 text-balance",children:l.filename.replaceAll("_"," ").replace(".jpg","").trim()}),e.jsxs("div",{className:`flex w-full justify-between items-center gap-4 my-4 ${s.theme.border.top} pt-8`,children:[e.jsx("div",{className:"flex justify-start items-center gap-1 text-[11px] leading-[20px]",children:e.jsxs("div",{className:m("flex-1 flex justify-between  w-full items-center gap-4  "),children:[e.jsx(v,{to:`/gallery/${t.slug}`,children:e.jsx("img",{src:o(t.slug,encodeURI(t.images[0].filename.replaceAll(" ","_")),160),alt:t.title,className:"w-16 h-16 object-cover"})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(f,{to:`/gallery/${t.slug}`,className:"text-base truncate",hasDecoration:!1,children:t.title})}),l.createDate&&b(l.createDate)&&e.jsx(f,{to:`/app/timeline?scrollTo=${b(l.createDate)?.toISOString().split("T")[0]}`,className:m("text-[11px] font-mono truncate"),children:b(l.createDate)&&new Date(b(l.createDate)).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric"})})]})]})}),e.jsx(j,{className:" min-h-4 min-w-4 sm:flex-row-reverse",iconToRight:!1,textToCopy:window.location.href,children:e.jsx("span",{className:"text-[11px] text-nowrap hidden sm:block truncate font-mono",children:"URL Kopieren"})})]}),e.jsxs("div",{className:`flex flex-col lg:flex-row-reverse gap-8 mt-4 ${s.theme.border.top} pt-4 md:pt-8`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base mb-2",children:"URLs"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[100px,1fr] gap-x-4 gap-y-3 text-sm",children:[e.jsx("div",{className:`text-[10px] tracking-wider font-mono pt-4 ${s.theme.border.top}`,children:"Original"}),e.jsxs("div",{className:m(`  flex items-center gap-2 font-mono pb-4 ${s.theme.border.bottom}`),children:[e.jsx(f,{href:o(t.slug,l.filename.replaceAll(" ","_"),"original"),hasDecoration:!1,className:m("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),"original")}`}),e.jsx(j,{className:"",textToCopy:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),"original")}`})]}),e.jsx("div",{className:"text-[10px] tracking-wider font-mono",children:"1440 px"}),e.jsxs("div",{className:m(`flex items-center gap-2 font-mono pb-4 ${s.theme.border.bottom}`),children:[e.jsx(f,{href:o(t.slug,l.filename.replaceAll(" ","_"),1440),hasDecoration:!1,className:m("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),1440)}`}),e.jsx(j,{textToCopy:window.location.href})]}),e.jsx("div",{className:"text-[10px] tracking-wider font-mono",children:"640 px"}),e.jsxs("div",{className:m(`flex items-center gap-2 font-mono pb-4 ${s.theme.border.bottom}`),children:[e.jsx(f,{href:o(t.slug,l.filename.replaceAll(" ","_"),640),hasDecoration:!1,className:m("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),640)}`}),e.jsx(j,{textToCopy:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),640)}`})]}),e.jsx("div",{className:"text-[10px] tracking-wider font-mono",children:"380 px"}),e.jsxs("div",{className:m(`flex items-center gap-2 font-mono pb-4 ${s.theme.border.bottom}`),children:[e.jsx(f,{href:o(t.slug,l.filename.replaceAll(" ","_"),380),hasDecoration:!1,className:m("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),380)}`}),e.jsx(j,{textToCopy:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),380)}`})]}),e.jsx("div",{className:"text-[10px] tracking-wider font-mono",children:"160 px"}),e.jsxs("div",{className:m(`flex items-center gap-2 font-mono pb-4 ${s.theme.border.bottom}`),children:[e.jsx(f,{href:o(t.slug,l.filename.replaceAll(" ","_"),160),hasDecoration:!1,className:m("truncate font-mono text-xs max-w-[calc(100%-40px)]"),children:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),160)}`}),e.jsx(j,{textToCopy:`${s.url}${o(t.slug,encodeURI(l.filename.replaceAll(" ","_")),160)}`})]})]})]}),l.latitude&&l.longitude&&e.jsxs("div",{className:"flex-1 mb-8 md:mb-4",children:[e.jsx("h2",{className:"text-base mb-2",children:"Standort & Karte"}),e.jsx("p",{className:"text-xs mb-2 font-mono text-[11px]",children:`${l.latitude.toFixed(4)}, ${l.longitude.toFixed(4)}`}),e.jsx("div",{className:"border aspect-square w-full overflow-hidden",children:e.jsx(E,{initialViewState:{latitude:l.latitude,longitude:l.longitude,zoom:12},style:{width:"100%",height:"100%"},mapStyle:i==="dark"?s.mapbox.style.dark:s.mapbox.style.light,mapboxAccessToken:s.mapbox.accessToken,scrollZoom:!0,dragPan:!1,children:e.jsx(L,{longitude:l.longitude,latitude:l.latitude,children:e.jsx("div",{children:e.jsx("div",{className:m("w-4 h-4 border border-white",i==="dark"?"bg-red-300":"bg-red-600")})})})},l.filename)}),e.jsxs("div",{className:"flex flex-wrap space-y-2 space-x-4 gap-0 mt-2",children:[e.jsx(v,{to:`/app/map?image=${y(l.filename.replace(/\.[^/.]+$/,""))}&gallery=${t.slug}`,className:m("text-sm inline-block underline underline-offset-4 inline-block ",i==="dark"?"text-white decoration-red-300 hover:text-red-300 hover:decoration-red-300":"text-black decoration-red-500 hover:text-red-600"),children:"Auf der Karte anzeigen"}),e.jsx(f,{className:"text-sm",href:`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,children:"Google Maps"}),e.jsx(f,{className:"text-sm",href:`http://maps.apple.com/?q=${l.latitude},${l.longitude}`,children:"Apple Maps"})]})]})]})]})]}),N.length>0&&e.jsxs("div",{className:"w-full pb-8 md:pb-0 max-w-4xl mt-8 pt-8 border-t border-neutral-500/50 border-dotted",children:[e.jsx("h2",{className:"text-base mb-4",children:"Andere Fotos"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-4",children:N.map(a=>e.jsx(v,{to:`/gallery/${a.gallerySlug}/image/${y(a.filename.replace(/\.[^/.]+$/,""))}`,className:"relative",children:e.jsx("img",{src:o(a.gallerySlug,a.filename.replaceAll(" ","_"),380),alt:a.filename.replaceAll("_"," ").replace(".jpg","").trim(),width:160,height:160,sizes:"(max-width: 768px) 50vw, 20vw",className:m("aspect-square object-cover w-full h-full",a.isRandomPick&&"")})},a.filename))})]})]})};export{Y as default};
