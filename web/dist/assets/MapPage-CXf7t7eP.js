import{d as ne,r as _,b as ae,e as ce,g as $,j as g,L as le}from"./index-75yTq_GF.js";import{M as ue,a as J,P as he}from"./scale-control-730j_0Fc.js";import"./mapbox-gl-CNTiHEyl.js";import{C as P}from"./config-BUEk0qKv.js";import{c as C}from"./cn-CBfrqCZ4.js";import{g as Y}from"./image-CpkqAB9L.js";import{H as de}from"./Href-CwOn-OWO.js";import{s as Q}from"./slugify-BCIJIR2V.js";import{D as pe}from"./download-BiZjaPQf.js";import"./index-syCU3izD.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],ge=ne("layers",fe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],we=ne("x",me),W=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],B=1,I=8;class V{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,s]=new Uint8Array(e,0,2);if(t!==219)throw new Error("Data does not appear to be in a KDBush format.");const i=s>>4;if(i!==B)throw new Error(`Got v${i} data when expected v${B}.`);const o=W[s&15];if(!o)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[c]=new Uint32Array(e,4,1);return new V(c,a,o,e)}constructor(e,t=64,s=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const o=W.indexOf(this.ArrayType),a=e*2*this.ArrayType.BYTES_PER_ELEMENT,c=e*this.IndexArrayType.BYTES_PER_ELEMENT,n=(8-c%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${s}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,I,e),this.coords=new this.ArrayType(this.data,I+c+n,e*2),this._pos=e*2,this._finished=!0):(this.data=new ArrayBuffer(I+a+c+n),this.ids=new this.IndexArrayType(this.data,I,e),this.coords=new this.ArrayType(this.data,I+c+n,e*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(B<<4)+o]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=t,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return K(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,s,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:a,nodeSize:c}=this,n=[0,o.length-1,0],u=[];for(;n.length;){const h=n.pop()||0,l=n.pop()||0,p=n.pop()||0;if(l-p<=c){for(let x=p;x<=l;x++){const M=a[2*x],A=a[2*x+1];M>=e&&M<=s&&A>=t&&A<=i&&u.push(o[x])}continue}const m=p+l>>1,y=a[2*m],w=a[2*m+1];y>=e&&y<=s&&w>=t&&w<=i&&u.push(o[m]),(h===0?e<=y:t<=w)&&(n.push(p),n.push(m-1),n.push(1-h)),(h===0?s>=y:i>=w)&&(n.push(m+1),n.push(l),n.push(1-h))}return u}within(e,t,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:a}=this,c=[0,i.length-1,0],n=[],u=s*s;for(;c.length;){const h=c.pop()||0,l=c.pop()||0,p=c.pop()||0;if(l-p<=a){for(let x=p;x<=l;x++)q(o[2*x],o[2*x+1],e,t)<=u&&n.push(i[x]);continue}const m=p+l>>1,y=o[2*m],w=o[2*m+1];q(y,w,e,t)<=u&&n.push(i[m]),(h===0?e-s<=y:t-s<=w)&&(c.push(p),c.push(m-1),c.push(1-h)),(h===0?e+s>=y:t+s>=w)&&(c.push(m+1),c.push(l),c.push(1-h))}return n}}function K(r,e,t,s,i,o){if(i-s<=t)return;const a=s+i>>1;ie(r,e,a,s,i,o),K(r,e,t,s,a-1,1-o),K(r,e,t,a+1,i,1-o)}function ie(r,e,t,s,i,o){for(;i>s;){if(i-s>600){const u=i-s+1,h=t-s+1,l=Math.log(u),p=.5*Math.exp(2*l/3),m=.5*Math.sqrt(l*p*(u-p)/u)*(h-u/2<0?-1:1),y=Math.max(s,Math.floor(t-h*p/u+m)),w=Math.min(i,Math.floor(t+(u-h)*p/u+m));ie(r,e,t,y,w,o)}const a=e[2*t+o];let c=s,n=i;for(O(r,e,s,t),e[2*i+o]>a&&O(r,e,s,i);c<n;){for(O(r,e,c,n),c++,n--;e[2*c+o]<a;)c++;for(;e[2*n+o]>a;)n--}e[2*s+o]===a?O(r,e,s,n):(n++,O(r,e,n,i)),n<=t&&(s=n+1),t<=n&&(i=n-1)}}function O(r,e,t,s){G(r,t,s),G(e,2*t,2*s),G(e,2*t+1,2*s+1)}function G(r,e,t){const s=r[e];r[e]=r[t],r[t]=s}function q(r,e,t,s){const i=r-t,o=e-s;return i*i+o*o}const ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:r=>r},X=Math.fround||(r=>e=>(r[0]=+e,r[0]))(new Float32Array(1)),S=2,N=3,H=4,k=5,re=6;class xe{constructor(e){this.options=Object.assign(Object.create(ye),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:s,maxZoom:i}=this.options;t&&console.time("total time");const o=`prepare ${e.length} points`;t&&console.time(o),this.points=e;const a=[];for(let n=0;n<e.length;n++){const u=e[n];if(!u.geometry)continue;const[h,l]=u.geometry.coordinates,p=X(z(h)),m=X(Z(l));a.push(p,m,1/0,n,-1,1),this.options.reduce&&a.push(0)}let c=this.trees[i+1]=this._createTree(a);t&&console.timeEnd(o);for(let n=i;n>=s;n--){const u=+Date.now();c=this.trees[n]=this._createTree(this._cluster(c,n)),t&&console.log("z%d: %d clusters in %dms",n,c.numItems,+Date.now()-u)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let s=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let o=e[2]===180?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)s=-180,o=180;else if(s>o){const l=this.getClusters([s,i,180,a],t),p=this.getClusters([-180,i,o,a],t);return l.concat(p)}const c=this.trees[this._limitZoom(t)],n=c.range(z(s),Z(a),z(o),Z(i)),u=c.data,h=[];for(const l of n){const p=this.stride*l;h.push(u[p+k]>1?ee(u,p,this.clusterProps):this.points[u[p+N]])}return h}getChildren(e){const t=this._getOriginId(e),s=this._getOriginZoom(e),i="No cluster with the specified id.",o=this.trees[s];if(!o)throw new Error(i);const a=o.data;if(t*this.stride>=a.length)throw new Error(i);const c=this.options.radius/(this.options.extent*Math.pow(2,s-1)),n=a[t*this.stride],u=a[t*this.stride+1],h=o.within(n,u,c),l=[];for(const p of h){const m=p*this.stride;a[m+H]===e&&l.push(a[m+k]>1?ee(a,m,this.clusterProps):this.points[a[m+N]])}if(l.length===0)throw new Error(i);return l}getLeaves(e,t,s){t=t||10,s=s||0;const i=[];return this._appendLeaves(i,e,t,s,0),i}getTile(e,t,s){const i=this.trees[this._limitZoom(e)],o=Math.pow(2,e),{extent:a,radius:c}=this.options,n=c/a,u=(s-n)/o,h=(s+1+n)/o,l={features:[]};return this._addTileFeatures(i.range((t-n)/o,u,(t+1+n)/o,h),i.data,t,s,o,l),t===0&&this._addTileFeatures(i.range(1-n/o,u,1,h),i.data,o,s,o,l),t===o-1&&this._addTileFeatures(i.range(0,u,n/o,h),i.data,-1,s,o,l),l.features.length?l:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const s=this.getChildren(e);if(t++,s.length!==1)break;e=s[0].properties.cluster_id}return t}_appendLeaves(e,t,s,i,o){const a=this.getChildren(t);for(const c of a){const n=c.properties;if(n&&n.cluster?o+n.point_count<=i?o+=n.point_count:o=this._appendLeaves(e,n.cluster_id,s,i,o):o<i?o++:e.push(c),e.length===s)break}return o}_createTree(e){const t=new V(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let s=0;s<e.length;s+=this.stride)t.add(e[s],e[s+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,s,i,o,a){for(const c of e){const n=c*this.stride,u=t[n+k]>1;let h,l,p;if(u)h=oe(t,n,this.clusterProps),l=t[n],p=t[n+1];else{const w=this.points[t[n+N]];h=w.properties;const[x,M]=w.geometry.coordinates;l=z(x),p=Z(M)}const m={type:1,geometry:[[Math.round(this.options.extent*(l*o-s)),Math.round(this.options.extent*(p*o-i))]],tags:h};let y;u||this.options.generateId?y=t[n+N]:y=this.points[t[n+N]].id,y!==void 0&&(m.id=y),a.features.push(m)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:s,extent:i,reduce:o,minPoints:a}=this.options,c=s/(i*Math.pow(2,t)),n=e.data,u=[],h=this.stride;for(let l=0;l<n.length;l+=h){if(n[l+S]<=t)continue;n[l+S]=t;const p=n[l],m=n[l+1],y=e.within(n[l],n[l+1],c),w=n[l+k];let x=w;for(const M of y){const A=M*h;n[A+S]>t&&(x+=n[A+k])}if(x>w&&x>=a){let M=p*w,A=m*w,j,F=-1;const T=((l/h|0)<<5)+(t+1)+this.points.length;for(const d of y){const f=d*h;if(n[f+S]<=t)continue;n[f+S]=t;const b=n[f+k];M+=n[f]*b,A+=n[f+1]*b,n[f+H]=T,o&&(j||(j=this._map(n,l,!0),F=this.clusterProps.length,this.clusterProps.push(j)),o(j,this._map(n,f)))}n[l+H]=T,u.push(M/x,A/x,1/0,T,-1,x),o&&u.push(F)}else{for(let M=0;M<h;M++)u.push(n[l+M]);if(x>1)for(const M of y){const A=M*h;if(!(n[A+S]<=t)){n[A+S]=t;for(let j=0;j<h;j++)u.push(n[A+j])}}}}return u}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,s){if(e[t+k]>1){const a=this.clusterProps[e[t+re]];return s?Object.assign({},a):a}const i=this.points[e[t+N]].properties,o=this.options.map(i);return s&&o===i?Object.assign({},o):o}}function ee(r,e,t){return{type:"Feature",id:r[e+N],properties:oe(r,e,t),geometry:{type:"Point",coordinates:[be(r[e]),_e(r[e+1])]}}}function oe(r,e,t){const s=r[e+k],i=s>=1e4?`${Math.round(s/1e3)}k`:s>=1e3?`${Math.round(s/100)/10}k`:s,o=r[e+re],a=o===-1?{}:Object.assign({},t[o]);return Object.assign(a,{cluster:!0,cluster_id:r[e+N],point_count:s,point_count_abbreviated:i})}function z(r){return r/360+.5}function Z(r){const e=Math.sin(r*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function be(r){return(r-.5)*360}function _e(r){const e=(180-r*360)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}var te=Object.prototype.hasOwnProperty;function se(r,e,t){for(t of r.keys())if(L(t,e))return t}function L(r,e){var t,s,i;if(r===e)return!0;if(r&&e&&(t=r.constructor)===e.constructor){if(t===Date)return r.getTime()===e.getTime();if(t===RegExp)return r.toString()===e.toString();if(t===Array){if((s=r.length)===e.length)for(;s--&&L(r[s],e[s]););return s===-1}if(t===Set){if(r.size!==e.size)return!1;for(s of r)if(i=s,i&&typeof i=="object"&&(i=se(e,i),!i)||!e.has(i))return!1;return!0}if(t===Map){if(r.size!==e.size)return!1;for(s of r)if(i=s[0],i&&typeof i=="object"&&(i=se(e,i),!i)||!L(s[1],e.get(i)))return!1;return!0}if(t===ArrayBuffer)r=new Uint8Array(r),e=new Uint8Array(e);else if(t===DataView){if((s=r.byteLength)===e.byteLength)for(;s--&&r.getInt8(s)===e.getInt8(s););return s===-1}if(ArrayBuffer.isView(r)){if((s=r.byteLength)===e.byteLength)for(;s--&&r[s]===e[s];);return s===-1}if(!t||typeof r=="object"){s=0;for(t in r)if(te.call(r,t)&&++s&&!te.call(e,t)||!(t in e)||!L(r[t],e[t]))return!1;return Object.keys(e).length===s}}return r!==r&&e!==e}function Me(r){var e=_.useRef(r),t=_.useRef(0);return L(r,e.current)||(e.current=r,t.current+=1),_.useMemo(function(){return e.current},[t.current])}function Ae(r,e){return _.useEffect(r,Me(e))}var Ee=function(e){var t=e.points,s=e.bounds,i=e.zoom,o=e.options,a=e.disableRefresh,c=_.useRef(),n=_.useRef(),u=_.useState([]),h=u[0],l=u[1],p=Math.round(i);return Ae(function(){a!==!0&&((!c.current||!L(n.current,t)||!L(c.current.options,o))&&(c.current=new xe(o),c.current.load(t)),s&&l(c.current.getClusters(s,p)),n.current=t)},[t,s,p,o,a]),{clusters:h,supercluster:c.current}};function je(r){return r.properties.cluster===!0}const Fe=()=>{const r=_.useRef(null),{theme:e}=ae(),[t,s]=_.useState(null),[i,o]=_.useState(!1),a=_.useRef(null),c=_.useRef(null),[n,u]=_.useState(new Set),[h,l]=_.useState(),[p]=ce(),[m,y]=_.useState({longitude:16,latitude:48,zoom:3}),w=_.useMemo(()=>{const d=[];return $.forEach(f=>{n.has(f.slug)||f.images?.forEach((b,E)=>{b.latitude&&b.longitude&&d.push({image:{...b,index:E},gallery:f})})}),d},[n]),x=_.useMemo(()=>{const d=["bg-rose-300","bg-fuchsia-300","bg-indigo-300","bg-sky-300","bg-emerald-300","bg-amber-300","bg-red-300","bg-violet-300","bg-cyan-300","bg-lime-300","bg-pink-300","bg-blue-300","bg-green-300","bg-yellow-300","bg-purple-300","bg-teal-300"],f=new Map;return $.forEach((b,E)=>{f.set(b.slug,d[E%d.length])}),f},[]),M=_.useMemo(()=>w.map(d=>({type:"Feature",properties:d,geometry:{type:"Point",coordinates:[d.image.longitude,d.image.latitude]}})),[w]);_.useEffect(()=>{const d=f=>{c.current&&!c.current.contains(f.target)&&a.current&&!a.current.contains(f.target)&&o(!1)};return i?document.addEventListener("mousedown",d):document.removeEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[i]),_.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]);const{clusters:A,supercluster:j}=Ee({points:M,bounds:h,zoom:m.zoom,options:{radius:75,maxZoom:13}}),F=_.useCallback(()=>{if(!r.current)return;const d=p.get("image");if(d){let f;for(const b of $){const E=b.images?.find(v=>Q(v.filename.replace(/\.[^/.]+$/,""))===d);if(E){f={image:E,gallery:b};break}}f&&f.image.latitude&&f.image.longitude&&(y({...m,latitude:f.image.latitude,longitude:f.image.longitude,zoom:14}),s(f))}else{if(w.length===0)return;if(w.length===1)y({longitude:w[0].image.longitude,latitude:w[0].image.latitude,zoom:10});else{const f=w.map(D=>D.image.longitude),b=w.map(D=>D.image.latitude),E=Math.min(...f),v=Math.max(...f),R=Math.min(...b),U=Math.max(...b);r.current.fitBounds([[E,R],[v,U]],{padding:80,duration:1e3})}}},[w,p]),T=_.useCallback(d=>{u(f=>{const b=new Set(f);return b.has(d)?b.delete(d):b.add(d),b})},[]);return g.jsxs("div",{className:"w-full h-screen relative overflow-hidden",children:[g.jsx("title",{children:`Foto Karte | ${P.meta.title}`}),g.jsx("meta",{name:"title",content:`Foto Karte | ${P.meta.title}`}),g.jsx("meta",{name:"description",content:"Eine interaktive Karte mit allen Fotos, die Geodaten enthalten."}),g.jsxs("button",{ref:c,onClick:()=>o(!i),className:C("z-10 absolute top-4 right-4 p-2 flex items-center",e==="dark"?"bg-black text-white":"bg-white text-black"),"aria-label":"Legende Ein- oder Ausschalten",children:[g.jsx("span",{className:"text-xs ml-2",children:"Legende"}),g.jsx(ge,{size:20})]}),i&&g.jsxs("div",{ref:a,className:C("z-10 absolute top-16 right-4 p-4 w-[calc(100%-2rem)] md:w-auto md:max-w-md",e==="dark"?"bg-black text-white":"bg-white text-black"),children:[g.jsx("button",{onClick:()=>o(!1),className:"absolute top-2 right-2 p-1","aria-label":"Legende schlieÃŸen",children:g.jsx(we,{className:"h-4 w-4"})}),g.jsx("h3",{className:"font-bold text-lg mb-2",children:"Legende"}),g.jsx("h4",{className:"text-xs mb-4",children:"Galerien via Farbe, Klick auf Galerie um zu verstecken oder einzublenden"}),g.jsx("ul",{className:"grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-2 text-sm",children:$.map(d=>g.jsxs("li",{className:`flex items-center gap-2 cursor-pointer ${n.has(d.slug)?"opacity-50":""}`,onClick:()=>T(d.slug),children:[g.jsx("div",{className:C(`w-3 h-3 border ${x.get(d.slug)}`,e==="dark"?"border-white":"border-black")}),g.jsx("span",{className:"truncate text-xs",children:d.title})]},d.slug))})]}),g.jsxs(ue,{...m,onMove:d=>{y(d.viewState),r.current&&l(r.current.getMap().getBounds()?.toArray().flat())},ref:r,style:{width:"100%",height:"100%"},mapStyle:e==="dark"?P.mapbox.style.dark:P.mapbox.style.light,mapboxAccessToken:P.mapbox.accessToken,onLoad:F,children:[A.map(d=>{const[f,b]=d.geometry.coordinates;if(je(d)){const{point_count:v,cluster_id:R}=d.properties;return g.jsx(J,{latitude:b,longitude:f,children:g.jsx("div",{className:`shadow-[-2px_0px_0px_#00000033] -rotate-45 ${e==="dark"?"bg-white text-black":"bg-black text-white"} border flex items-center justify-center cursor-pointer`,style:{width:`${30+v/M.length*40}px`,height:`${30+v/M.length*40}px`},onClick:()=>{if(!j)return;const U=Math.min(j.getClusterExpansionZoom(R),20);y({...m,longitude:f,latitude:b,zoom:U})},children:g.jsx("span",{className:"rotate-45",children:v})})},` cluster-${R}`)}const E=d.properties;return g.jsx(J,{longitude:E.image.longitude,latitude:E.image.latitude,anchor:"center",onClick:v=>{v.originalEvent?.stopPropagation(),s(E)},children:g.jsx("div",{className:C(`shadow-[1px_1px_0px_#00000033] h-3 w-3 border ${x.get(E.gallery.slug)||"bg-gray-400"} ${e==="dark"?"border-white":"border-gray-800"}`)})},`marker-${E.image.filename}`)}),t&&g.jsx(he,{anchor:"top",longitude:Number(t.image.longitude),latitude:Number(t.image.latitude),onClose:()=>s(null),closeButton:!1,className:"z-10",children:g.jsxs("div",{className:"relative bg-white text-black",children:[g.jsx("div",{className:"relative group ",children:g.jsx(le,{to:`/image/${Q(t.image.filename.replace(/\.[^/.]+$/,""))}`,children:g.jsx("img",{className:"w-40 md:w-64 w-full h-auto",src:Y(t.gallery.slug,t.image.filename.replaceAll(" ","_"),640),alt:t.image.alt||t.image.filename.replaceAll("_"," ").replace(".jpg",""),loading:"lazy"})})}),g.jsxs("section",{className:"flex items-start justify-between gap-2",children:[g.jsxs("div",{className:C("font-geist p-2 text-base truncate"),children:[g.jsx("p",{className:"truncate",children:t.image.filename.replaceAll("_"," ")}),g.jsx("p",{className:"text-sm truncate",children:t.gallery.title})]}),g.jsx(de,{href:Y(t.gallery.slug,t.image.filename.replaceAll(" ","_"),"original"),download:!0,onClick:d=>d.stopPropagation(),className:"p-2 px-3 mt-1 text-black","aria-label":`Download ${t.image.filename}`,children:g.jsx(pe,{size:16})})]})]})})]})]})};export{Fe as default};
