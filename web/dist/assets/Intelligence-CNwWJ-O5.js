import{h as Z,c as U,u as B,J,r as z,j as i,L as W,s as ee,b as te,g as H,C as se}from"./index-CFH5Ecws.js";import{M as ae}from"./map-pin-DMRkffl5.js";import{E as re}from"./eye-DBCQp0Ts.js";import{S as ne}from"./SeoHead-0sUubTIU.js";import"./mapbox-gl-CVYYZmbF.js";const le=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ie=Z("calendar",le),oe=c=>{const e=U.c(45),{onApiKeySet:t}=c,{theme:s}=B(),{showToast:r}=J(),[a,n]=z.useState(""),[l,o]=z.useState(!1);let h;e[0]!==a||e[1]!==t||e[2]!==r?(h=async()=>{if(a.trim()){if(o(!0),!a.startsWith("AIza")){r('Invalid API key format. Google Vision API keys should start with "AIza"',"error"),o(!1);return}localStorage.setItem("google-vision-api-key",a.trim()),setTimeout(()=>{t(a.trim()),o(!1)},500)}},e[0]=a,e[1]=t,e[2]=r,e[3]=h):h=e[3];const g=h,d=`max-w-md mx-auto p-8 ${s==="dark"?"bg-black text-white":"bg-white text-black"} border ${s==="dark"?"border-white":"border-black"}`,m=`text-xl font-semibold mb-6 text-center ${s==="dark"?"text-white":"text-black"}`;let p;e[4]!==m?(p=i.jsx("h2",{className:m,children:"Google Vision API Key Required"}),e[4]=m,e[5]=p):p=e[5];const f=`block text-sm font-medium mb-2 ${s==="dark"?"text-white":"text-black"}`;let w;e[6]!==f?(w=i.jsx("label",{htmlFor:"apiKey",className:f,children:"API Key"}),e[6]=f,e[7]=w):w=e[7];let j;e[8]===Symbol.for("react.memo_cache_sentinel")?(j=q=>n(q.target.value),e[8]=j):j=e[8];const k=`w-full px-3 py-2 border focus:outline-none ${s==="dark"?"border-white bg-black text-white focus:border-red-500":"border-black bg-white text-black focus:border-red-500"}`;let y;e[9]!==a||e[10]!==k?(y=i.jsx("input",{type:"password",id:"apiKey",value:a,onChange:j,placeholder:"Enter your Google Vision API key",className:k}),e[9]=a,e[10]=k,e[11]=y):y=e[11];let S;e[12]!==w||e[13]!==y?(S=i.jsxs("div",{className:"mb-6",children:[w,y]}),e[12]=w,e[13]=y,e[14]=S):S=e[14];let b;e[15]!==a||e[16]!==l?(b=!a.trim()||l,e[15]=a,e[16]=l,e[17]=b):b=e[17];const L=`w-full font-medium py-2 px-4 transition-colors ${!a.trim()||l?s==="dark"?"bg-gray-800 text-gray-500":"bg-gray-200 text-gray-400":"bg-red-600 hover:bg-red-700 text-white"}`,N=l?"Validating...":"Set API Key";let x;e[18]!==g||e[19]!==b||e[20]!==L||e[21]!==N?(x=i.jsx("button",{onClick:g,disabled:b,"aria-label":"Set API Key",className:L,children:N}),e[18]=g,e[19]=b,e[20]=L,e[21]=N,e[22]=x):x=e[22];const D=`mt-8 p-4 border ${s==="dark"?"border-white":"border-black"}`,v=`text-sm font-medium mb-2 ${s==="dark"?"text-white":"text-black"}`;let $;e[23]!==v?($=i.jsx("h3",{className:v,children:"How to get your API key:"}),e[23]=v,e[24]=$):$=e[24];const E=`text-sm space-y-1 list-decimal list-inside ${s==="dark"?"text-white":"text-black"}`;let K,C,T,R,A;e[25]===Symbol.for("react.memo_cache_sentinel")?(K=i.jsxs("li",{children:["Go to ",i.jsx("a",{href:"https://console.cloud.google.com/",target:"_blank",rel:"noopener noreferrer",className:"underline text-red-600",children:"Google Cloud Console"})]}),C=i.jsx("li",{children:"Create a new project or select an existing one"}),T=i.jsx("li",{children:'Enable the "Cloud Vision API"'}),R=i.jsx("li",{children:'Go to "Credentials" and create an API key'}),A=i.jsx("li",{children:'Restrict the key to "Cloud Vision API" only'}),e[25]=K,e[26]=C,e[27]=T,e[28]=R,e[29]=A):(K=e[25],C=e[26],T=e[27],R=e[28],A=e[29]);let P;e[30]!==E?(P=i.jsxs("ol",{className:E,children:[K,C,T,R,A]}),e[30]=E,e[31]=P):P=e[31];const _=`text-xs mt-2 ${s==="dark"?"text-gray-300":"text-gray-600"}`;let I;e[32]!==_?(I=i.jsx("p",{className:_,children:"Your API key is stored locally and never sent to our servers."}),e[32]=_,e[33]=I):I=e[33];let M;e[34]!==D||e[35]!==$||e[36]!==P||e[37]!==I?(M=i.jsxs("div",{className:D,children:[$,P,I]}),e[34]=D,e[35]=$,e[36]=P,e[37]=I,e[38]=M):M=e[38];let G;return e[39]!==S||e[40]!==x||e[41]!==d||e[42]!==M||e[43]!==p?(G=i.jsxs("div",{className:d,children:[p,S,x,M]}),e[39]=S,e[40]=x,e[41]=d,e[42]=M,e[43]=p,e[44]=G):G=e[44],G},ce=c=>{const e=U.c(18),{images:t,message:s}=c,{theme:r}=B(),a=de;if(t.length===0){const g=`text-center py-8 ${r==="light"?"text-gray-500":"text-gray-400"}`;let d;e[0]!==s?(d=i.jsx("p",{children:s}),e[0]=s,e[1]=d):d=e[1];let m;return e[2]!==g||e[3]!==d?(m=i.jsx("div",{className:g,children:d}),e[2]=g,e[3]=d,e[4]=m):m=e[4],m}let n;e[5]!==s||e[6]!==r?(n=s&&i.jsx("div",{className:"p-3 border ",children:i.jsx("p",{className:"font-medium",children:s})}),e[5]=s,e[6]=r,e[7]=n):n=e[7];let l;if(e[8]!==t||e[9]!==r){let g;e[11]!==r?(g=(d,m)=>i.jsxs("div",{className:`border overflow-hidden ${r==="dark"?"bg-black border-white":"bg-white border-black"}`,children:[i.jsx(W,{to:`/gallery/${d.gallerySlug}/image/${ee(d.filename.replace(/\.[^/.]+$/,""))}`,children:i.jsx("div",{className:"aspect-square overflow-hidden",children:i.jsx("img",{src:te(d.gallerySlug,d.filename,380),alt:d.filename,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"})})}),i.jsxs("div",{className:"p-3 space-y-2",children:[i.jsx("h3",{className:`font-medium text-sm truncate ${r==="dark"?"text-white":"text-black"}`,children:d.filename.replace(/\.[^/.]+$/,"")}),i.jsx(W,{to:`/gallery/${d.gallerySlug}`,className:`text-xs underline ${r==="dark"?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-700"}`,children:d.galleryTitle}),"              ",i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[d.createDate&&i.jsxs("div",{className:`flex items-center gap-1 ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:[i.jsx(ie,{size:12}),a(d.createDate)]}),d.latitude&&d.longitude&&i.jsxs("div",{className:`flex items-center gap-1 ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:[i.jsx(ae,{size:12}),"GPS"]})]}),"              ",d.aiAnalysis&&d.aiAnalysis.labels.length>0&&i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:`flex items-center gap-1 text-xs ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:[i.jsx(re,{size:12}),"AI erkannt:"]}),i.jsx("div",{className:"flex flex-wrap gap-1",children:d.aiAnalysis.labels.slice(0,3).map((p,f)=>i.jsx("span",{className:`px-2 py-1 text-xs border ${r==="dark"?"border-white text-white":"border-black text-black"}`,children:p.description},f))})]})]})]},`${d.gallerySlug}-${d.filename}-${m}`),e[11]=r,e[12]=g):g=e[12],l=t.map(g),e[8]=t,e[9]=r,e[10]=l}else l=e[10];let o;e[13]!==l?(o=i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l}),e[13]=l,e[14]=o):o=e[14];let h;return e[15]!==n||e[16]!==o?(h=i.jsxs("div",{className:"space-y-4",children:[n,"      ",o]}),e[15]=n,e[16]=o,e[17]=h):h=e[17],h};function de(c){return new Date(c).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}const he=c=>{const e=U.c(58),{messages:t,onSendMessage:s,isLoading:r,apiKey:a,onApiKeyChange:n}=c,{theme:l}=B(),[o,h]=z.useState(""),g=z.useRef(null),d=z.useRef(null);let m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m=()=>{g.current?.scrollIntoView({behavior:"smooth"})},e[0]=m):m=e[0];let p;e[1]!==r||e[2]!==t?(p=[t,r],e[1]=r,e[2]=t,e[3]=p):p=e[3],z.useEffect(m,p);let f,w;e[4]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{d.current?.focus()},w=[],e[4]=f,e[5]=w):(f=e[4],w=e[5]),z.useEffect(f,w);let j;e[6]!==o||e[7]!==r||e[8]!==s?(j=u=>{u.preventDefault(),!(!o.trim()||r)&&(s(o.trim()),h(""))},e[6]=o,e[7]=r,e[8]=s,e[9]=j):j=e[9];const k=j;let y;e[10]===Symbol.for("react.memo_cache_sentinel")?(y=["Show me photos from last week","I want to see pictures with trees and buildings","Can you find 5 random images with people?","What photos do I have from Vienna?","Show me beautiful landscape photos from this year"],e[10]=y):y=e[10];const S=y;let b;e[11]!==s?(b=u=>{h(u),s(u)},e[11]=s,e[12]=b):b=e[12];const L=b,N=`flex flex-col h-full w-full ${l==="dark"?"bg-black text-white":"bg-white text-black"}`;let x;e[13]!==a||e[14]!==n?(x=()=>{const u=prompt("Enter new Google Vision API key:",a);u!==null&&(u.trim()?(localStorage.setItem("google-vision-api-key",u.trim()),n(u.trim())):(localStorage.removeItem("google-vision-api-key"),n("")))},e[13]=a,e[14]=n,e[15]=x):x=e[15];const D=`px-3 py-1 text-xs border ${l==="dark"?"border-white text-white hover:bg-white hover:text-black":"border-black text-black hover:bg-black hover:text-white"} transition-colors`;let v;e[16]!==D||e[17]!==x?(v=i.jsx("div",{className:"absolute top-4 right-4 z-10",children:i.jsx("button",{onClick:x,"aria-label":"Change API Key",className:D,children:"Change API Key"})}),e[16]=D,e[17]=x,e[18]=v):v=e[18];let $;e[19]!==L||e[20]!==t.length||e[21]!==l?($=t.length===0&&i.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-w-2xl mx-auto",children:S.map((u,V)=>i.jsx("button",{onClick:()=>L(u),"aria-label":`Use example query: ${u}`,className:`p-3 text-sm text-left border transition-colors ${l==="dark"?"border-white text-white hover:bg-white hover:text-black":"border-black text-black hover:bg-black hover:text-white"}`,children:u},V))})}),e[19]=L,e[20]=t.length,e[21]=l,e[22]=$):$=e[22];let E;if(e[23]!==t||e[24]!==l){let u;e[26]!==l?(u=(V,X)=>i.jsx("div",{className:`flex ${V.type==="user"?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 ${V.type==="user"?"bg-red-600 text-white":l==="dark"?"bg-white text-black":"bg-black text-white"}`,children:[i.jsx("p",{className:"text-sm",children:V.content}),V.results&&V.results.length>0&&i.jsx("div",{className:"mt-3",children:i.jsx(ce,{images:V.results,message:""})})]})},X),e[26]=l,e[27]=u):u=e[27],E=t.map(u),e[23]=t,e[24]=l,e[25]=E}else E=e[25];let K;e[28]===Symbol.for("react.memo_cache_sentinel")?(K=i.jsx("div",{ref:g}),e[28]=K):K=e[28];let C;e[29]!==$||e[30]!==E?(C=i.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",ref:g,children:[$,E,K]}),e[29]=$,e[30]=E,e[31]=C):C=e[31];const T=`border-t p-4 ${l==="dark"?"border-white":"border-black"}`;let R;e[32]===Symbol.for("react.memo_cache_sentinel")?(R=u=>h(u.target.value),e[32]=R):R=e[32];let A;e[33]!==k?(A=u=>u.key==="Enter"&&k(u),e[33]=k,e[34]=A):A=e[34];const P=`flex-1 px-3 py-2 border focus:outline-none ${l==="dark"?"border-white bg-black text-white focus:border-red-500":"border-black bg-white text-black focus:border-red-500"}`;let _;e[35]!==o||e[36]!==r||e[37]!==A||e[38]!==P?(_=i.jsx("input",{ref:d,type:"text",value:o,onChange:R,onKeyPress:A,placeholder:"Ask about your photos...",disabled:r,className:P}),e[35]=o,e[36]=r,e[37]=A,e[38]=P,e[39]=_):_=e[39];let I;e[40]!==k?(I=u=>k(u),e[40]=k,e[41]=I):I=e[41];const M=!o.trim()||r,G=`px-4 py-2 transition-colors ${!o.trim()||r?l==="dark"?"bg-gray-800 text-gray-500":"bg-gray-200 text-gray-400":"bg-red-600 hover:bg-red-700 text-white"}`,q=r?"Sending...":"Send";let F;e[42]!==I||e[43]!==M||e[44]!==G||e[45]!==q?(F=i.jsx("button",{onClick:I,disabled:M,"aria-label":"Send message",className:G,children:q}),e[42]=I,e[43]=M,e[44]=G,e[45]=q,e[46]=F):F=e[46];let Y;e[47]!==_||e[48]!==F?(Y=i.jsxs("div",{className:"flex space-x-2",children:[_,F]}),e[47]=_,e[48]=F,e[49]=Y):Y=e[49];let O;e[50]!==T||e[51]!==Y?(O=i.jsx("div",{className:T,children:Y}),e[50]=T,e[51]=Y,e[52]=O):O=e[52];let Q;return e[53]!==v||e[54]!==C||e[55]!==O||e[56]!==N?(Q=i.jsxs("div",{className:N,children:[v,C,O]}),e[53]=v,e[54]=C,e[55]=O,e[56]=N,e[57]=Q):Q=e[57],Q};class me{apiKey;baseUrl="https://vision.googleapis.com/v1/images:annotate";constructor(e){this.apiKey=e}async analyzeImage(e){try{const t=await fetch(`${this.baseUrl}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requests:[{image:{source:{imageUri:e}},features:[{type:"LABEL_DETECTION",maxResults:10},{type:"TEXT_DETECTION",maxResults:1}]}]})});if(!t.ok)throw new Error(`API request failed: ${t.status} ${t.statusText}`);const r=(await t.json()).responses[0];if(r.error)throw new Error(`Vision API error: ${r.error.message}`);return{labels:r.labelAnnotations?.map(a=>({description:a.description.toLowerCase(),confidence:a.score}))||[],text:r.textAnnotations?.[0]?.description||void 0}}catch(t){return console.error("Error analyzing image:",t),{labels:[],error:t instanceof Error?t.message:"Unknown error occurred"}}}async analyzeImages(e){const s=[];for(let r=0;r<e.length;r+=5){const n=e.slice(r,r+5).map(o=>this.analyzeImage(o)),l=await Promise.all(n);s.push(...l),r+5<e.length&&await new Promise(o=>setTimeout(o,100))}return s}}class ue{visionService;analysisCache=new Map;constructor(e){this.visionService=new me(e),this.loadCachedAnalysis()}loadCachedAnalysis(){try{const e=localStorage.getItem("vision-analysis-cache");if(e){const t=JSON.parse(e);this.analysisCache=new Map(t)}}catch(e){console.error("Error loading cached analysis:",e)}}saveCachedAnalysis(){try{const e=Array.from(this.analysisCache.entries());localStorage.setItem("vision-analysis-cache",JSON.stringify(e))}catch(e){console.error("Error saving cached analysis:",e)}}async processQuery(e){const t=this.analyzeIntent(e),s=this.parseNaturalLanguage(e,t);let a=[...H.flatMap(n=>n.images.map(l=>({...l,gallerySlug:n.slug,galleryTitle:n.title})))];if(s.dateRange&&(a=a.filter(n=>{if(!n.createDate)return!1;const l=new Date(n.createDate);return l>=s.dateRange.start&&l<=s.dateRange.end})),s.location){const n=s.location.toLowerCase();a=a.filter(l=>{const o=H.find(h=>h.slug===l.gallerySlug);return o?.tags?o.tags.some(h=>h.toLowerCase().includes(n)):o?.title.toLowerCase().includes(n)||!1})}return s.galleryNames&&s.galleryNames.length>0&&(a=a.filter(n=>{const l=H.find(o=>o.slug===n.gallerySlug);return s.galleryNames.some(o=>l?.title.toLowerCase().includes(o)||l?.slug.toLowerCase().includes(o))})),s.content&&s.content.length>0&&(a=await this.filterByContent(a,s.content)),s.random&&s.limit?a=this.getRandomItems(a,s.limit):s.limit&&(a=a.slice(0,s.limit)),{type:"images",items:a,message:this.generateResponseMessage(a.length,s,e),totalFound:a.length}}analyzeIntent(e){const t=e.toLowerCase(),s=[/\b(find|search|look for|show me|get|where|what|which|can you find|i want to see)\b/,/\b(suche|finde|zeige|wo|was|welche|kannst du finden|ich möchte sehen|ich will sehen|zeig mir)\b/],r=[/\b(browse|explore|see|view|display|all|give me)\b/,/\b(durchsuchen|erkunden|ansehen|alle|anzeigen|gib mir|lass mich sehen)\b/],a=[/\b(filter|only|just|exclude|without)\b/,/\b(filtern|nur|ohne|ausschließen)\b/];let n={type:"search",confidence:.5,entities:{}};return s.some(l=>l.test(t))?(n.type="search",n.confidence=.8):r.some(l=>l.test(t))?(n.type="browse",n.confidence=.7):a.some(l=>l.test(t))&&(n.type="filter",n.confidence=.7),n.entities=this.extractEntities(e),n}extractEntities(e){const t={},s=e.toLowerCase();return t.dates=this.extractDates(e),t.locations=this.extractLocations(s),t.objects=this.extractObjects(s),t.galleries=this.extractGalleries(s),t.quantities=this.extractQuantities(s),t.modifiers=this.extractModifiers(s),t}extractDates(e){const t=[],s=e.toLowerCase();return[{pattern:/\b(today|heute)\b/,value:"today"},{pattern:/\b(yesterday|gestern)\b/,value:"yesterday"},{pattern:/\b(last week|letzte woche|vergangene woche)\b/,value:"last_week"},{pattern:/\b(last month|letzten monat|vergangenen monat)\b/,value:"last_month"},{pattern:/\b(last year|letztes jahr|vergangenes jahr)\b/,value:"last_year"},{pattern:/\b(this week|diese woche)\b/,value:"this_week"},{pattern:/\b(this month|diesen monat)\b/,value:"this_month"},{pattern:/\b(this year|dieses jahr)\b/,value:"this_year"},{pattern:/\b(recent|recently|kürzlich|neulich)\b/,value:"last_week"}].forEach(({pattern:n,value:l})=>{n.test(s)&&t.push(l)}),[/(\d{1,2})[.\/\s]+(\d{1,2})[.\/\s]+(\d{4})/g,/(\d{1,2})[.\/\s]+(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)[.\/\s]*(\d{4})/gi,/(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)\s+(\d{4})/gi].forEach(n=>{[...e.matchAll(n)].forEach(o=>{t.push(o[0])})}),t}extractLocations(e){const t=[];["wien","vienna","salzburg","burghausen","österreich","austria","deutschland","germany","schweiz","swiss","zürich","zurich","berlin","karlsruhe","bern","munich","münchen","innsbruck"].forEach(n=>{e.includes(n)&&t.push(n)});const r=/\b(?:in|at|from|aus|von|bei)\s+([a-zA-ZäöüÄÖÜß\s]+?)\b/gi;return[...e.matchAll(r)].forEach(n=>{const l=n[1].trim();l.length>2&&t.push(l)}),t}extractObjects(e){const t=[];return Object.entries({tree:["tree","trees","baum","bäume"],flower:["flower","flowers","blume","blumen"],sky:["sky","himmel","clouds","wolken"],water:["water","wasser","sea","meer","lake","see"],mountain:["mountain","mountains","berg","berge"],forest:["forest","wald","woods"],building:["building","buildings","haus","häuser","gebäude"],bridge:["bridge","brücke"],church:["church","kirche"],castle:["castle","schloss"],car:["car","cars","auto","autos"],train:["train","zug","trains","züge"],bike:["bike","bicycle","fahrrad"],person:["person","people","menschen","man","woman","child"],animal:["animal","animals","tier","tiere","dog","cat","bird"],table:["table","tables","tisch","tische"],chair:["chair","chairs","stuhl","stühle"],lamp:["lamp","lamps","lampe","lampen"],glass:["glass","glasses","glas","gläser"]}).forEach(([r,a])=>{a.forEach(n=>{new RegExp(`\\b${n}\\b`,"i").test(e)&&t.push(r)})}),[...new Set(t)]}extractGalleries(e){const t=[],s=/["']([^"']+)["']/g;return[...e.matchAll(s)].forEach(n=>{t.push(n[1])}),["öffis","arsenal","wien"].forEach(n=>{e.includes(n)&&t.push(n)}),t}extractQuantities(e){const t=[],s=/\b(\d+)\b/g;return[...e.matchAll(s)].forEach(a=>{const n=parseInt(a[1]);n>0&&n<1e3&&t.push(n)}),t}extractModifiers(e){const t=[];return[{pattern:/\b(random|zufällig)\b/i,value:"random"},{pattern:/\b(recent|newest|latest|neueste)\b/i,value:"recent"},{pattern:/\b(old|oldest|älteste)\b/i,value:"oldest"},{pattern:/\b(best|favorite|lieblings)\b/i,value:"best"}].forEach(({pattern:r,value:a})=>{r.test(e)&&t.push(a)}),t}parseNaturalLanguage(e,t){const s={intent:t.type,confidence:t.confidence};return t.entities.dates&&t.entities.dates.length>0&&(s.dateRange=this.processDates(t.entities.dates)),t.entities.locations&&t.entities.locations.length>0&&(s.location=t.entities.locations[0]),t.entities.objects&&t.entities.objects.length>0&&(s.content=t.entities.objects),t.entities.galleries&&t.entities.galleries.length>0&&(s.galleryNames=t.entities.galleries),t.entities.quantities&&t.entities.quantities.length>0&&(s.limit=t.entities.quantities[0]),t.entities.modifiers&&t.entities.modifiers.includes("random")&&(s.random=!0),s}processDates(e){const t=new Date;for(const s of e)switch(s){case"today":return{start:new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0),end:new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59)};case"yesterday":const r=new Date(t);return r.setDate(r.getDate()-1),{start:new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0),end:new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59)};case"last_week":const a=new Date(t);return a.setDate(a.getDate()-7),a.setHours(0,0,0,0),{start:a,end:t};case"this_week":const n=new Date(t);return n.setDate(n.getDate()-t.getDay()),n.setHours(0,0,0,0),{start:n,end:t};case"last_month":const l=new Date(t);return l.setMonth(l.getMonth()-1),l.setDate(1),l.setHours(0,0,0,0),{start:l,end:t};case"this_month":return{start:new Date(t.getFullYear(),t.getMonth(),1,0,0,0),end:t};case"last_year":const h=new Date(t);return h.setFullYear(h.getFullYear()-1),h.setMonth(0),h.setDate(1),h.setHours(0,0,0,0),{start:h,end:t};case"this_year":return{start:new Date(t.getFullYear(),0,1,0,0,0),end:t};default:const d=this.parseSpecificDate(s);if(d)return d}}parseSpecificDate(e){const t=[/^(\d{1,2})[.\/](\d{1,2})[.\/](\d{4})$/,/^(\d{1,2})\s+(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)\s+(\d{4})$/i,/^(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)\s+(\d{4})$/i];for(const s of t){const r=e.match(s);if(r)try{let a;if(s.source.includes("januar")){const n={januar:0,februar:1,märz:2,april:3,mai:4,juni:5,juli:6,august:7,september:8,oktober:9,november:10,dezember:11};if(r[3]){const l=parseInt(r[1]),o=n[r[2].toLowerCase()],h=parseInt(r[3]);a=new Date(h,o,l)}else{const l=n[r[1].toLowerCase()],o=parseInt(r[2]);return{start:new Date(o,l,1),end:new Date(o,l+1,0,23,59,59)}}}else{const n=parseInt(r[1]),l=parseInt(r[2])-1,o=parseInt(r[3]);a=new Date(o,l,n)}return{start:new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),end:new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59)}}catch{continue}}}async filterByContent(e,t){const s=[],a=e.slice(0,50);for(const n of a){const l=`${n.gallerySlug}/${n.filename}`;let o=this.analysisCache.get(l);if(!o)try{const h=`https://photos.lucamack.at/content/galleries/${n.gallerySlug}/${encodeURI(n.filename.replaceAll(" ","_"))}`;if(o=await this.visionService.analyzeImage(h),!o.error)this.analysisCache.set(l,o),this.saveCachedAnalysis();else{this.analysisCache.set(l,{labels:[],error:o.error});continue}}catch(h){console.error(`Failed to analyze image ${l}:`,h),this.analysisCache.set(l,{labels:[],error:"Analysis failed"});continue}o.error||o&&o.labels&&t.some(g=>o.labels.some(d=>{const m=d.description.toLowerCase(),p=this.translateContent(m),f=g.toLowerCase();return d.confidence>.5&&(m===f||p===f||m.includes(f)||p.includes(f)||f.includes(m)||f.includes(p))}))&&s.push({...n,aiAnalysis:o})}return s}translateContent(e){return{tree:"baum",building:"haus",house:"haus",car:"auto",vehicle:"auto",person:"person",people:"menschen",human:"mensch",sky:"himmel",water:"wasser",flower:"blume",plant:"pflanze",animal:"tier",dog:"hund",cat:"katze",bird:"vogel",food:"essen",table:"tisch",chair:"stuhl",window:"fenster",door:"tür",street:"straße",road:"straße",bridge:"brücke",mountain:"berg",forest:"wald",lake:"see",river:"fluss",baum:"tree",haus:"building",auto:"car",mensch:"person",menschen:"people",himmel:"sky",wasser:"water",blume:"flower"}[e.toLowerCase()]||e}getRandomItems(e,t){return[...e].sort(()=>.5-Math.random()).slice(0,t)}generateResponseMessage(e,t,s){const r=/\b(zeige|finde|suche|bilder|fotos|aus|von|mit|der|die|das)\b/i.test(s);if(e===0)return r?`Keine Bilder gefunden für "${s}". Versuche eine andere Suchanfrage.`:`No images found for "${s}". Try a different search query.`;let a;if(r){if(a=`${e} Bild${e===1?"":"er"} gefunden`,t.dateRange){const n=t.dateRange.start.toLocaleDateString("de-DE");a+=` vom ${n}`}t.location&&(a+=` aus ${t.location}`),t.content&&t.content.length>0&&(a+=` mit ${t.content.join(", ")}`),t.galleryNames&&t.galleryNames.length>0&&(a+=` aus der "${t.galleryNames.join('", "')}" Galerie`)}else{if(a=`Found ${e} image${e===1?"":"s"}`,t.dateRange){const n=t.dateRange.start.toLocaleDateString("en-US");a+=` from ${n}`}t.location&&(a+=` from ${t.location}`),t.content&&t.content.length>0&&(a+=` with ${t.content.join(", ")}`),t.galleryNames&&t.galleryNames.length>0&&(a+=` from "${t.galleryNames.join('", "')}" gallery`)}return a+"."}}const xe=()=>{const c=U.c(16),{theme:e}=B(),{showToast:t}=J(),[s,r]=z.useState("");let a;c[0]===Symbol.for("react.memo_cache_sentinel")?(a=[],c[0]=a):a=c[0];const[n,l]=z.useState(a),[o,h]=z.useState(!1);let g,d;c[1]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{const b=localStorage.getItem("google-vision-api-key");b&&r(b)},d=[],c[1]=g,c[2]=d):(g=c[1],d=c[2]),z.useEffect(g,d);let m;c[3]===Symbol.for("react.memo_cache_sentinel")?(m=b=>{r(b),b?localStorage.setItem("google-vision-api-key",b):localStorage.removeItem("google-vision-api-key")},c[3]=m):m=c[3];const p=m;let f;c[4]!==s||c[5]!==t?(f=async b=>{if(!s){t("Please enter your Google Vision API key first.","error");return}const L={type:"user",content:b,timestamp:new Date};l(N=>[...N,L]),h(!0);try{const x=await new ue(s).processQuery(b),D={type:"ai",content:x.message,timestamp:new Date,results:x.items};l(v=>[...v,D]),h(!1)}catch(N){console.error("Error processing message:",N);const D={type:"ai",content:"Sorry, there was an error processing your request. Please try again.",timestamp:new Date};l(v=>[...v,D]),h(!1)}},c[4]=s,c[5]=t,c[6]=f):f=c[6];const w=f,j=`w-full h-full md:h-screen relative overflow-hidden ${e==="dark"?"bg-black text-white":"bg-white text-black"}`;let k;c[7]===Symbol.for("react.memo_cache_sentinel")?(k=i.jsx(ne,{title:`KI Foto Chat | ${se.meta.title}`,description:"Chatte mit einem KI über alle Bilder auf dieser Website",noIndex:!0}),c[7]=k):k=c[7];let y;c[8]!==s||c[9]!==w||c[10]!==o||c[11]!==n?(y=s?i.jsx(he,{messages:n,onSendMessage:w,isLoading:o,apiKey:s,onApiKeyChange:p}):i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsx(oe,{onApiKeySet:r})}),c[8]=s,c[9]=w,c[10]=o,c[11]=n,c[12]=y):y=c[12];let S;return c[13]!==j||c[14]!==y?(S=i.jsxs("div",{className:j,children:[k,y]}),c[13]=j,c[14]=y,c[15]=S):S=c[15],S};export{xe as default};
