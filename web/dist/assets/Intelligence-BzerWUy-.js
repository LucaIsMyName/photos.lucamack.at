import{h as q,c as le,u as ae,r as P,j as t,L as he,g as de,C as ue}from"./index-CHvF8oBg.js";import{S as ye}from"./SeoHead-5G5X-ZcF.js";import{E as me}from"./eye-CgtBSNKP.js";import{M as fe}from"./map-pin-CdMZIuuV.js";import"./mapbox-gl-CNTiHEyl.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],ge=q("bot",xe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],pe=q("calendar",be);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],we=q("external-link",je);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ne=q("eye-off",ve);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],ke=q("key",$e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Ie=q("loader-circle",Se);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Ce=q("send",Ae);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ze=q("user",_e),Me=a=>{const e=le.c(76),{onApiKeyChange:l}=a,{theme:i}=ae(),[s,r]=P.useState(""),[n,g]=P.useState(!1),[d,m]=P.useState(!1);let h;e[0]!==s||e[1]!==l?(h=async ce=>{if(ce.preventDefault(),!!s.trim()){if(m(!0),!s.startsWith("AIza")){alert('Invalid API key format. Google Vision API keys should start with "AIza"'),m(!1);return}setTimeout(()=>{l(s.trim()),m(!1)},500)}},e[0]=s,e[1]=l,e[2]=h):h=e[2];const c=h,x=`max-w-2xl mx-auto p-6 rounded-lg border ${i==="light"?"bg-gray-50 border-gray-200":"bg-gray-900 border-gray-700"}`,y=`mx-auto mb-4 ${i==="light"?"text-gray-600":"text-gray-400"}`;let o;e[3]!==y?(o=t.jsx(ke,{className:y,size:48}),e[3]=y,e[4]=o):o=e[4];const u=`text-2xl font-bold mb-2 ${i==="light"?"text-black":"text-white"}`;let w;e[5]!==u?(w=t.jsx("h2",{className:u,children:"Google Vision API Key Required"}),e[5]=u,e[6]=w):w=e[6];const z=`${i==="light"?"text-gray-600":"text-gray-400"}`;let k;e[7]!==z?(k=t.jsx("p",{className:z,children:"To analyze your photos with AI, please enter your Google Cloud Vision API key."}),e[7]=z,e[8]=k):k=e[8];let S;e[9]!==o||e[10]!==w||e[11]!==k?(S=t.jsxs("div",{className:"text-center mb-6",children:[o,w,k]}),e[9]=o,e[10]=w,e[11]=k,e[12]=S):S=e[12];const D=`block text-sm font-medium mb-2 ${i==="light"?"text-gray-700":"text-gray-300"}`;let v;e[13]!==D?(v=t.jsx("label",{className:D,children:"API Key"}),e[13]=D,e[14]=v):v=e[14];const N=n?"text":"password";let j;e[15]===Symbol.for("react.memo_cache_sentinel")?(j=ce=>r(ce.target.value),e[15]=j):j=e[15];const I=`w-full px-4 py-3 pr-12 rounded-lg border ${i==="light"?"bg-white border-gray-300 text-black focus:border-blue-500":"bg-gray-800 border-gray-600 text-white focus:border-blue-400"} focus:outline-none focus:ring-2 focus:ring-blue-500/20`;let b;e[16]!==s||e[17]!==N||e[18]!==I?(b=t.jsx("input",{type:N,value:s,onChange:j,placeholder:"AIzaSy...",className:I,required:!0}),e[16]=s,e[17]=N,e[18]=I,e[19]=b):b=e[19];let A;e[20]!==n?(A=()=>g(!n),e[20]=n,e[21]=A):A=e[21];const E=`absolute right-3 top-1/2 transform -translate-y-1/2 ${i==="light"?"text-gray-500 hover:text-gray-700":"text-gray-400 hover:text-gray-200"}`;let C;e[22]!==n?(C=n?t.jsx(Ne,{size:20}):t.jsx(me,{size:20}),e[22]=n,e[23]=C):C=e[23];let _;e[24]!==A||e[25]!==E||e[26]!==C?(_=t.jsx("button",{type:"button",onClick:A,className:E,children:C}),e[24]=A,e[25]=E,e[26]=C,e[27]=_):_=e[27];let $;e[28]!==b||e[29]!==_?($=t.jsxs("div",{className:"relative",children:[b,_]}),e[28]=b,e[29]=_,e[30]=$):$=e[30];let R;e[31]!==v||e[32]!==$?(R=t.jsxs("div",{children:[v,$]}),e[31]=v,e[32]=$,e[33]=R):R=e[33];let L;e[34]!==s||e[35]!==d?(L=!s.trim()||d,e[34]=s,e[35]=d,e[36]=L):L=e[36];const F=`w-full py-3 px-4 rounded-lg font-medium transition-colors ${i==="light"?"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 text-white":"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white"} disabled:cursor-not-allowed`,T=d?"Validating...":"Save API Key";let M;e[37]!==L||e[38]!==F||e[39]!==T?(M=t.jsx("button",{type:"submit",disabled:L,className:F,children:T}),e[37]=L,e[38]=F,e[39]=T,e[40]=M):M=e[40];let V;e[41]!==c||e[42]!==R||e[43]!==M?(V=t.jsxs("form",{onSubmit:c,className:"space-y-4",children:[R,M]}),e[41]=c,e[42]=R,e[43]=M,e[44]=V):V=e[44];const G=`mt-6 p-4 rounded-lg ${i==="light"?"bg-blue-50 border border-blue-200":"bg-blue-900/20 border border-blue-800"}`,B=`font-medium mb-2 ${i==="light"?"text-blue-800":"text-blue-300"}`;let K;e[45]!==B?(K=t.jsx("h3",{className:B,children:"Don't have an API key?"}),e[45]=B,e[46]=K):K=e[46];const p=`text-sm mb-3 ${i==="light"?"text-blue-700":"text-blue-400"}`;let f;e[47]!==p?(f=t.jsx("p",{className:p,children:"Get your free Google Cloud Vision API key with 1,000 free requests per month:"}),e[47]=p,e[48]=f):f=e[48];const re=`text-sm space-y-1 mb-3 ${i==="light"?"text-blue-700":"text-blue-400"}`;let W,Y,Z,X,ee;e[49]===Symbol.for("react.memo_cache_sentinel")?(W=t.jsx("li",{children:"1. Go to Google Cloud Console"}),Y=t.jsx("li",{children:"2. Create a new project"}),Z=t.jsx("li",{children:"3. Enable Vision API"}),X=t.jsx("li",{children:"4. Create credentials â†’ API Key"}),ee=t.jsx("li",{children:"5. Restrict key to Vision API only"}),e[49]=W,e[50]=Y,e[51]=Z,e[52]=X,e[53]=ee):(W=e[49],Y=e[50],Z=e[51],X=e[52],ee=e[53]);let O;e[54]!==re?(O=t.jsxs("ol",{className:re,children:[W,Y,Z,X,ee]}),e[54]=re,e[55]=O):O=e[55];const ne=`inline-flex items-center gap-2 text-sm font-medium ${i==="light"?"text-blue-600 hover:text-blue-800":"text-blue-400 hover:text-blue-200"}`;let te;e[56]===Symbol.for("react.memo_cache_sentinel")?(te=t.jsx(we,{size:14}),e[56]=te):te=e[56];let U;e[57]!==ne?(U=t.jsxs("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank",rel:"noopener noreferrer",className:ne,children:["Open Google Cloud Console",te]}),e[57]=ne,e[58]=U):U=e[58];let Q;e[59]!==G||e[60]!==K||e[61]!==f||e[62]!==O||e[63]!==U?(Q=t.jsxs("div",{className:G,children:[K,f,O,U]}),e[59]=G,e[60]=K,e[61]=f,e[62]=O,e[63]=U,e[64]=Q):Q=e[64];const ie=`mt-4 p-3 rounded-lg ${i==="light"?"bg-yellow-50 border border-yellow-200":"bg-yellow-900/20 border border-yellow-800"}`,oe=`text-xs ${i==="light"?"text-yellow-700":"text-yellow-400"}`;let H;e[65]!==oe?(H=t.jsx("p",{className:oe,children:"ðŸ”’ Your API key is stored locally in your browser and never sent to our servers."}),e[65]=oe,e[66]=H):H=e[66];let J;e[67]!==ie||e[68]!==H?(J=t.jsx("div",{className:ie,children:H}),e[67]=ie,e[68]=H,e[69]=J):J=e[69];let se;return e[70]!==x||e[71]!==V||e[72]!==Q||e[73]!==J||e[74]!==S?(se=t.jsxs("div",{className:x,children:[S,V,Q,J]}),e[70]=x,e[71]=V,e[72]=Q,e[73]=J,e[74]=S,e[75]=se):se=e[75],se},De=(a,e,l="original")=>{const i=encodeURI(e.replaceAll(" ","_"));if(l==="original")return`/content/galleries/${a}/${i}`;const s=e.split(".").pop()?.toLowerCase(),r=e.replace(/\.[^/.]+$/,"").replaceAll(" ","_");return`/content/galleries/${a}/${r}-${l}w.${s}`},Ee=a=>{const e=le.c(21),{images:l,message:i}=a,{theme:s}=ae(),r=Pe;if(l.length===0){const y=`text-center py-8 ${s==="light"?"text-gray-500":"text-gray-400"}`;let o;e[0]!==i?(o=t.jsx("p",{children:i}),e[0]=i,e[1]=o):o=e[1];let u;return e[2]!==y||e[3]!==o?(u=t.jsx("div",{className:y,children:o}),e[2]=y,e[3]=o,e[4]=u):u=e[4],u}const n=`p-3 rounded-lg ${s==="light"?"bg-blue-50 border border-blue-200":"bg-blue-900/20 border border-blue-800"}`,g=`font-medium ${s==="light"?"text-blue-800":"text-blue-300"}`;let d;e[5]!==i||e[6]!==g?(d=t.jsx("p",{className:g,children:i}),e[5]=i,e[6]=g,e[7]=d):d=e[7];let m;e[8]!==n||e[9]!==d?(m=t.jsx("div",{className:n,children:d}),e[8]=n,e[9]=d,e[10]=m):m=e[10];let h;if(e[11]!==l||e[12]!==s){let y;e[14]!==s?(y=(o,u)=>t.jsxs("div",{className:`rounded-lg border overflow-hidden ${s==="light"?"bg-white border-gray-200":"bg-gray-800 border-gray-700"}`,children:[t.jsx(he,{to:`/gallery/${o.gallerySlug}/image/${encodeURIComponent(o.filename.replace(/\.[^/.]+$/,""))}`,children:t.jsx("div",{className:"aspect-square overflow-hidden",children:t.jsx("img",{src:De(o.gallerySlug,o.filename,"380"),alt:o.filename,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"})})}),t.jsxs("div",{className:"p-3 space-y-2",children:[t.jsx("h3",{className:`font-medium text-sm truncate ${s==="light"?"text-gray-900":"text-gray-100"}`,children:o.filename.replace(/\.[^/.]+$/,"")}),t.jsx(he,{to:`/gallery/${o.gallerySlug}`,className:`text-xs ${s==="light"?"text-blue-600 hover:text-blue-800":"text-blue-400 hover:text-blue-200"}`,children:o.galleryTitle}),t.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[o.createDate&&t.jsxs("div",{className:`flex items-center gap-1 ${s==="light"?"text-gray-600":"text-gray-400"}`,children:[t.jsx(pe,{size:12}),r(o.createDate)]}),o.latitude&&o.longitude&&t.jsxs("div",{className:`flex items-center gap-1 ${s==="light"?"text-gray-600":"text-gray-400"}`,children:[t.jsx(fe,{size:12}),"GPS"]})]}),o.aiAnalysis&&o.aiAnalysis.labels.length>0&&t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:`flex items-center gap-1 text-xs ${s==="light"?"text-gray-600":"text-gray-400"}`,children:[t.jsx(me,{size:12}),"AI erkannt:"]}),t.jsx("div",{className:"flex flex-wrap gap-1",children:o.aiAnalysis.labels.slice(0,3).map((w,z)=>t.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s==="light"?"bg-gray-100 text-gray-700":"bg-gray-700 text-gray-300"}`,children:w.description},z))})]})]})]},`${o.gallerySlug}-${o.filename}-${u}`),e[14]=s,e[15]=y):y=e[15],h=l.map(y),e[11]=l,e[12]=s,e[13]=h}else h=e[13];let c;e[16]!==h?(c=t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h}),e[16]=h,e[17]=c):c=e[17];let x;return e[18]!==m||e[19]!==c?(x=t.jsxs("div",{className:"space-y-4",children:[m,c]}),e[18]=m,e[19]=c,e[20]=x):x=e[20],x};function Pe(a){return new Date(a).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}const Ke=a=>{const e=le.c(53),{messages:l,onSendMessage:i,isLoading:s}=a,{theme:r}=ae(),[n,g]=P.useState(""),d=P.useRef(null),m=P.useRef(null);let h;e[0]===Symbol.for("react.memo_cache_sentinel")?(h=()=>{d.current?.scrollIntoView({behavior:"smooth"})},e[0]=h):h=e[0];let c;e[1]!==s||e[2]!==l?(c=[l,s],e[1]=s,e[2]=l,e[3]=c):c=e[3],P.useEffect(h,c);let x,y;e[4]===Symbol.for("react.memo_cache_sentinel")?(x=()=>{m.current?.focus()},y=[],e[4]=x,e[5]=y):(x=e[4],y=e[5]),P.useEffect(x,y);let o;e[6]!==n||e[7]!==s||e[8]!==i?(o=p=>{p.preventDefault(),!(!n.trim()||s)&&(i(n.trim()),g(""))},e[6]=n,e[7]=s,e[8]=i,e[9]=o):o=e[9];const u=o;let w;e[10]!==u?(w=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),u(p))},e[10]=u,e[11]=w):w=e[11];const z=w,k=Re;let S;e[12]===Symbol.for("react.memo_cache_sentinel")?(S=["Zeige mir alle Bilder mit BÃ¤umen","Bilder vom 20. April 2025","3 zufÃ¤llige Fotos aus Wien","Alle Bilder mit Regenbogen","Fotos aus der 'Ã¶ffis' Galerie"],e[12]=S):S=e[12];const D=S,v=`flex flex-col h-[600px] rounded-lg border ${r==="light"?"bg-white border-gray-200":"bg-gray-900 border-gray-700"}`;let N;e[13]!==l.length||e[14]!==r?(N=l.length===0&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ge,{className:`mx-auto mb-4 ${r==="light"?"text-gray-400":"text-gray-600"}`,size:48}),t.jsx("h3",{className:`text-lg font-medium mb-2 ${r==="light"?"text-gray-700":"text-gray-300"}`,children:"Frag mich etwas Ã¼ber deine Fotos!"}),t.jsx("p",{className:`text-sm mb-4 ${r==="light"?"text-gray-500":"text-gray-400"}`,children:"Ich kann dir helfen, deine Fotosammlung zu durchsuchen und zu analysieren."}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:`text-xs font-medium ${r==="light"?"text-gray-600":"text-gray-400"}`,children:"Beispiele:"}),t.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:D.map((p,f)=>t.jsx("button",{onClick:()=>g(p),className:`px-3 py-1 text-xs rounded-full border transition-colors ${r==="light"?"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100":"bg-gray-800 border-gray-600 text-gray-300 hover:bg-gray-700"}`,children:p},f))})]})]}),e[13]=l.length,e[14]=r,e[15]=N):N=e[15];let j;if(e[16]!==l||e[17]!==r){let p;e[19]!==r?(p=f=>t.jsxs("div",{className:`flex gap-3 ${f.type==="user"?"justify-end":"justify-start"}`,children:[f.type==="ai"&&t.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${r==="light"?"bg-blue-100":"bg-blue-900"}`,children:t.jsx(ge,{className:`${r==="light"?"text-blue-600":"text-blue-400"}`,size:16})}),t.jsxs("div",{className:`max-w-[80%] ${f.type==="user"?"order-1":""}`,children:[t.jsx("div",{className:`px-4 py-2 rounded-lg ${f.type==="user"?"bg-blue-600 text-white":r==="light"?"bg-gray-100 text-gray-900":"bg-gray-800 text-gray-100"}`,children:t.jsx("p",{className:"whitespace-pre-wrap",children:f.content})}),f.type==="ai"&&f.results&&f.results.length>0&&t.jsx("div",{className:"mt-3",children:t.jsx(Ee,{images:f.results,message:""})}),t.jsx("p",{className:`text-xs mt-1 ${r==="light"?"text-gray-500":"text-gray-400"} ${f.type==="user"?"text-right":"text-left"}`,children:k(f.timestamp)})]}),f.type==="user"&&t.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${r==="light"?"bg-gray-100":"bg-gray-800"}`,children:t.jsx(ze,{className:`${r==="light"?"text-gray-600":"text-gray-400"}`,size:16})})]},f.id),e[19]=r,e[20]=p):p=e[20],j=l.map(p),e[16]=l,e[17]=r,e[18]=j}else j=e[18];let I;e[21]!==s||e[22]!==r?(I=s&&t.jsxs("div",{className:"flex gap-3 justify-start",children:[t.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${r==="light"?"bg-blue-100":"bg-blue-900"}`,children:t.jsx(ge,{className:`${r==="light"?"text-blue-600":"text-blue-400"}`,size:16})}),t.jsx("div",{className:`px-4 py-2 rounded-lg ${r==="light"?"bg-gray-100":"bg-gray-800"}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:`animate-spin ${r==="light"?"text-gray-600":"text-gray-400"}`,size:16}),t.jsx("span",{className:`${r==="light"?"text-gray-600":"text-gray-400"}`,children:"Analysiere deine Anfrage..."})]})})]}),e[21]=s,e[22]=r,e[23]=I):I=e[23];let b;e[24]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsx("div",{ref:d}),e[24]=b):b=e[24];let A;e[25]!==j||e[26]!==I||e[27]!==N?(A=t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[N,j,I,b]}),e[25]=j,e[26]=I,e[27]=N,e[28]=A):A=e[28];const E=`border-t p-4 ${r==="light"?"border-gray-200 bg-gray-50":"border-gray-700 bg-gray-800"}`;let C;e[29]===Symbol.for("react.memo_cache_sentinel")?(C=p=>g(p.target.value),e[29]=C):C=e[29];const _=`flex-1 px-4 py-2 rounded-lg border ${r==="light"?"bg-white border-gray-300 text-black focus:border-blue-500":"bg-gray-700 border-gray-600 text-white focus:border-blue-400"} focus:outline-none focus:ring-2 focus:ring-blue-500/20`;let $;e[30]!==z||e[31]!==n||e[32]!==s||e[33]!==_?($=t.jsx("input",{ref:m,type:"text",value:n,onChange:C,onKeyDown:z,placeholder:"Frag mich etwas Ã¼ber deine Fotos...",className:_,disabled:s}),e[30]=z,e[31]=n,e[32]=s,e[33]=_,e[34]=$):$=e[34];const R=!n.trim()||s,L=`px-4 py-2 rounded-lg font-medium transition-colors ${r==="light"?"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 text-white":"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white"} disabled:cursor-not-allowed`;let F;e[35]===Symbol.for("react.memo_cache_sentinel")?(F=t.jsx(Ce,{size:18}),e[35]=F):F=e[35];let T;e[36]!==R||e[37]!==L?(T=t.jsx("button",{type:"submit",disabled:R,className:L,children:F}),e[36]=R,e[37]=L,e[38]=T):T=e[38];let M;e[39]!==u||e[40]!==$||e[41]!==T?(M=t.jsxs("form",{onSubmit:u,className:"flex gap-2",children:[$,T]}),e[39]=u,e[40]=$,e[41]=T,e[42]=M):M=e[42];const V=`text-xs mt-2 ${r==="light"?"text-gray-500":"text-gray-400"}`;let G;e[43]!==V?(G=t.jsx("p",{className:V,children:"DrÃ¼cke Enter zum Senden, Shift+Enter fÃ¼r neue Zeile"}),e[43]=V,e[44]=G):G=e[44];let B;e[45]!==E||e[46]!==M||e[47]!==G?(B=t.jsxs("div",{className:E,children:[M,G]}),e[45]=E,e[46]=M,e[47]=G,e[48]=B):B=e[48];let K;return e[49]!==A||e[50]!==B||e[51]!==v?(K=t.jsxs("div",{className:v,children:[A,B]}),e[49]=A,e[50]=B,e[51]=v,e[52]=K):K=e[52],K};function Re(a){return a.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}class Le{apiKey;baseUrl="https://vision.googleapis.com/v1/images:annotate";constructor(e){this.apiKey=e}async analyzeImage(e){try{const l=await fetch(`${this.baseUrl}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requests:[{image:{source:{imageUri:e}},features:[{type:"LABEL_DETECTION",maxResults:10},{type:"TEXT_DETECTION",maxResults:1}]}]})});if(!l.ok)throw new Error(`API request failed: ${l.status} ${l.statusText}`);const s=(await l.json()).responses[0];if(s.error)throw new Error(`Vision API error: ${s.error.message}`);return{labels:s.labelAnnotations?.map(r=>({description:r.description.toLowerCase(),confidence:r.score}))||[],text:s.textAnnotations?.[0]?.description||void 0}}catch(l){return console.error("Error analyzing image:",l),{labels:[],error:l instanceof Error?l.message:"Unknown error occurred"}}}async analyzeImages(e){const i=[];for(let s=0;s<e.length;s+=5){const n=e.slice(s,s+5).map(d=>this.analyzeImage(d)),g=await Promise.all(n);i.push(...g),s+5<e.length&&await new Promise(d=>setTimeout(d,100))}return i}}class Te{visionService;analysisCache=new Map;constructor(e){this.visionService=new Le(e),this.loadCachedAnalysis()}loadCachedAnalysis(){try{const e=localStorage.getItem("vision-analysis-cache");if(e){const l=JSON.parse(e);this.analysisCache=new Map(l)}}catch(e){console.error("Error loading cached analysis:",e)}}saveCachedAnalysis(){try{const e=Array.from(this.analysisCache.entries());localStorage.setItem("vision-analysis-cache",JSON.stringify(e))}catch(e){console.error("Error saving cached analysis:",e)}}async processQuery(e){const l=this.parseQuery(e.toLowerCase());let s=[...de.flatMap(r=>r.images.map(n=>({...n,gallerySlug:r.slug,galleryTitle:r.title})))];if(l.dateRange&&(s=s.filter(r=>{if(!r.createDate)return!1;const n=new Date(r.createDate);return n>=l.dateRange.start&&n<=l.dateRange.end})),l.location){const r=l.location.toLowerCase();s=s.filter(n=>{const g=de.find(d=>d.slug===n.gallerySlug);return g?.tags?g.tags.some(d=>d.toLowerCase().includes(r)):g?.title.toLowerCase().includes(r)||!1})}return l.galleryNames&&l.galleryNames.length>0&&(s=s.filter(r=>{const n=de.find(g=>g.slug===r.gallerySlug);return l.galleryNames.some(g=>n?.title.toLowerCase().includes(g)||n?.slug.toLowerCase().includes(g))})),l.content&&l.content.length>0&&(s=await this.filterByContent(s,l.content)),l.random&&l.limit?s=this.getRandomItems(s,l.limit):l.limit&&(s=s.slice(0,l.limit)),{type:"images",items:s,message:this.generateResponseMessage(s.length,l,e),totalFound:s.length}}parseQuery(e){const l={},i=[/(\d{1,2})\.?\s*(\d{1,2})\.?\s*(\d{4})/g,/(\d{4})-(\d{1,2})-(\d{1,2})/g,/(januar|februar|mÃ¤rz|april|mai|juni|juli|august|september|oktober|november|dezember)\s*(\d{4})/gi,/(august|april)\s*(\d{4})/gi];for(const m of i){const h=[...e.matchAll(m)];if(h.length>0){const c=h[0];if(c[3]){const x=parseInt(c[1]),y=parseInt(c[2])-1,o=parseInt(c[3]),u=new Date(o,y,x);l.dateRange={start:u,end:new Date(u.getTime()+24*60*60*1e3)}}else if(c[2]&&!isNaN(parseInt(c[2]))){const x=parseInt(c[2]),y=c[1].toLowerCase(),u={januar:0,februar:1,mÃ¤rz:2,april:3,mai:4,juni:5,juli:6,august:7,september:8,oktober:9,november:10,dezember:11}[y];u!==void 0&&(l.dateRange={start:new Date(x,u,1),end:new Date(x,u+1,0,23,59,59)})}break}}const s=[/(?:aus|von|in)\s+(wien|vienna|Ã¶sterreich|austria)/gi,/wien|vienna/gi,/(\d+)\s*km\s*(?:um|around)/gi];for(const m of s){const h=e.match(m);if(h){l.location=h[0].replace(/(?:aus|von|in)\s+/gi,"").trim();break}}const r=[/(?:aus|von)\s+(?:der\s+)?["']([^"']+)["']\s*(?:galerie|gallery)/gi,/["']([^"']+)["']\s*(?:galerie|gallery)/gi,/(?:Ã¶ffis|wien|arsenal)/gi];for(const m of r){const h=[...e.matchAll(m)];if(h.length>0){l.galleryNames=h.map(c=>c[1]||c[0]).map(c=>c.toLowerCase());break}}const g=["baum","bÃ¤ume","tree","trees","regenbogen","rainbow","auto","car","cars","haus","hÃ¤user","house","houses","building","person","menschen","people","himmel","sky","wasser","water","blume","blumen","flower","flowers"].filter(m=>e.includes(m));g.length>0&&(l.content=g);const d=e.match(/(\d+)\s*(?:zufÃ¤llige|random|bilder|fotos|images)/i);return d&&(l.limit=parseInt(d[1]),l.random=e.includes("zufÃ¤llige")||e.includes("random")),l}async filterByContent(e,l){const i=[];for(const s of e){const r=`${s.gallerySlug}/${s.filename}`;let n=this.analysisCache.get(r);if(!n){const g=`${ue.url}/content/galleries/${s.gallerySlug}/${encodeURI(s.filename.replaceAll(" ","_"))}`;n=await this.visionService.analyzeImage(g),n.error||(this.analysisCache.set(r,n),this.saveCachedAnalysis())}n&&n.labels&&l.some(d=>n.labels.some(m=>m.description.includes(d)||this.translateContent(m.description).includes(d)))&&i.push({...s,aiAnalysis:n})}return i}translateContent(e){return{tree:"baum",building:"haus",car:"auto",person:"person",sky:"himmel",water:"wasser",flower:"blume"}[e.toLowerCase()]||e}getRandomItems(e,l){return[...e].sort(()=>.5-Math.random()).slice(0,l)}generateResponseMessage(e,l,i){if(e===0)return`Keine Bilder gefunden fÃ¼r "${i}". Versuche eine andere Suchanfrage.`;let s=`${e} Bild${e===1?"":"er"} gefunden`;if(l.dateRange){const r=l.dateRange.start.toLocaleDateString("de-DE");s+=` vom ${r}`}return l.location&&(s+=` aus ${l.location}`),l.content&&l.content.length>0&&(s+=` mit ${l.content.join(", ")}`),l.galleryNames&&l.galleryNames.length>0&&(s+=` aus der "${l.galleryNames.join('", "')}" Galerie`),s+"."}}const Oe=()=>{const a=le.c(26),{theme:e}=ae(),[l,i]=P.useState("");let s;a[0]===Symbol.for("react.memo_cache_sentinel")?(s=[],a[0]=s):s=a[0];const[r,n]=P.useState(s),[g,d]=P.useState(!1);let m,h;a[1]===Symbol.for("react.memo_cache_sentinel")?(m=()=>{const b=localStorage.getItem("google-vision-api-key");b&&i(b)},h=[],a[1]=m,a[2]=h):(m=a[1],h=a[2]),P.useEffect(m,h);let c;a[3]===Symbol.for("react.memo_cache_sentinel")?(c=b=>{i(b),b?localStorage.setItem("google-vision-api-key",b):localStorage.removeItem("google-vision-api-key")},a[3]=c):c=a[3];const x=c;let y;a[4]!==l?(y=async b=>{if(!l){alert("Please enter your Google Vision API key first.");return}const A={id:Date.now().toString(),type:"user",content:b,timestamp:new Date};n(E=>[...E,A]),d(!0);try{const C=await new Te(l).processQuery(b),_={id:(Date.now()+1).toString(),type:"ai",content:C.message,timestamp:new Date,results:C.items};n($=>[...$,_]),d(!1)}catch(E){console.error("Error processing message:",E);const _={id:(Date.now()+1).toString(),type:"ai",content:"Sorry, there was an error processing your request. Please try again.",timestamp:new Date};n($=>[...$,_]),d(!1)}},a[4]=l,a[5]=y):y=a[5];const o=y;let u;a[6]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(ye,{title:"Intelligence - AI Photo Assistant",description:"Chat with AI about your photo collection. Ask questions about images, locations, dates, and content."}),a[6]=u):u=a[6];const w=`min-h-screen ${e==="light"?"bg-white":"bg-black"}`,z=`text-3xl font-bold mb-4 ${e==="light"?"text-black":"text-white"}`;let k;a[7]!==z?(k=t.jsx("h1",{className:z,children:"Photo Intelligence"}),a[7]=z,a[8]=k):k=a[8];const S=`text-lg mb-6 ${e==="light"?"text-gray-600":"text-gray-400"}`;let D;a[9]!==S?(D=t.jsx("p",{className:S,children:"Chat with AI about your photo collection. Ask questions about images, locations, dates, and content."}),a[9]=S,a[10]=D):D=a[10];let v;a[11]!==D||a[12]!==k?(v=t.jsxs("div",{className:"mb-8",children:[k,D]}),a[11]=D,a[12]=k,a[13]=v):v=a[13];let N;a[14]!==l||a[15]!==o||a[16]!==g||a[17]!==r||a[18]!==e?(N=l?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:`p-4 rounded-lg ${e==="light"?"bg-green-50 border border-green-200":"bg-green-900/20 border border-green-800"}`,children:t.jsxs("p",{className:`text-sm ${e==="light"?"text-green-700":"text-green-300"}`,children:["âœ“ API Key configured. You can now chat with AI about your photos.",t.jsx("button",{onClick:()=>x(""),className:`ml-2 underline ${e==="light"?"text-green-600 hover:text-green-800":"text-green-400 hover:text-green-200"}`,children:"Change key"})]})}),t.jsx(Ke,{messages:r,onSendMessage:o,isLoading:g})]}):t.jsx(Me,{onApiKeyChange:x}),a[14]=l,a[15]=o,a[16]=g,a[17]=r,a[18]=e,a[19]=N):N=a[19];let j;a[20]!==v||a[21]!==N?(j=t.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[v,N]}),a[20]=v,a[21]=N,a[22]=j):j=a[22];let I;return a[23]!==j||a[24]!==w?(I=t.jsxs(t.Fragment,{children:[u,t.jsx("div",{className:w,children:j})]}),a[23]=j,a[24]=w,a[25]=I):I=a[25],I};export{Oe as default};
