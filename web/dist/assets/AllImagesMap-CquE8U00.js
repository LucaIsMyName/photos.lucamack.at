import{h as fe,r as E,c as ge,a as z,j as d,X as ee,u as me,i as ye,g as R,s as te,p as xe,b as se,C as G,L as we}from"./index-Dor3FEuZ.js";import{M as be,a as ne,P as Me}from"./scale-control-TLJXIKet.js";import{S as _e,L as je}from"./layer-Cr0I7T0c.js";import"./mapbox-gl-CVYYZmbF.js";import{H as Ee}from"./Href-BerY7w0G.js";import{E as Ae}from"./eye-CfsVQoz4.js";import{S as ke}from"./SeoHead-ZtRnc1ZN.js";const Se=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],ve=fe("layers",Se),ie=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],V=1,$=8;class Q{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,s]=new Uint8Array(e,0,2);if(t!==219)throw new Error("Data does not appear to be in a KDBush format.");const i=s>>4;if(i!==V)throw new Error(`Got v${i} data when expected v${V}.`);const o=ie[s&15];if(!o)throw new Error("Unrecognized array type.");const[l]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new Q(a,l,o,e)}constructor(e,t=64,s=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const o=ie.indexOf(this.ArrayType),l=e*2*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,n=(8-a%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${s}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,$,e),this.coords=new this.ArrayType(this.data,$+a+n,e*2),this._pos=e*2,this._finished=!0):(this.data=new ArrayBuffer($+l+a+n),this.ids=new this.IndexArrayType(this.data,$,e),this.coords=new this.ArrayType(this.data,$+a+n,e*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(V<<4)+o]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=t,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return q(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,s,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:l,nodeSize:a}=this,n=[0,o.length-1,0],u=[];for(;n.length;){const h=n.pop()||0,c=n.pop()||0,p=n.pop()||0;if(c-p<=a){for(let m=p;m<=c;m++){const x=l[2*m],_=l[2*m+1];x>=e&&x<=s&&_>=t&&_<=i&&u.push(o[m])}continue}const f=p+c>>1,M=l[2*f],y=l[2*f+1];M>=e&&M<=s&&y>=t&&y<=i&&u.push(o[f]),(h===0?e<=M:t<=y)&&(n.push(p),n.push(f-1),n.push(1-h)),(h===0?s>=M:i>=y)&&(n.push(f+1),n.push(c),n.push(1-h))}return u}within(e,t,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:l}=this,a=[0,i.length-1,0],n=[],u=s*s;for(;a.length;){const h=a.pop()||0,c=a.pop()||0,p=a.pop()||0;if(c-p<=l){for(let m=p;m<=c;m++)re(o[2*m],o[2*m+1],e,t)<=u&&n.push(i[m]);continue}const f=p+c>>1,M=o[2*f],y=o[2*f+1];re(M,y,e,t)<=u&&n.push(i[f]),(h===0?e-s<=M:t-s<=y)&&(a.push(p),a.push(f-1),a.push(1-h)),(h===0?e+s>=M:t+s>=y)&&(a.push(f+1),a.push(c),a.push(1-h))}return n}}function q(r,e,t,s,i,o){if(i-s<=t)return;const l=s+i>>1;ue(r,e,l,s,i,o),q(r,e,t,s,l-1,1-o),q(r,e,t,l+1,i,1-o)}function ue(r,e,t,s,i,o){for(;i>s;){if(i-s>600){const u=i-s+1,h=t-s+1,c=Math.log(u),p=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*p*(u-p)/u)*(h-u/2<0?-1:1),M=Math.max(s,Math.floor(t-h*p/u+f)),y=Math.min(i,Math.floor(t+(u-h)*p/u+f));ue(r,e,t,M,y,o)}const l=e[2*t+o];let a=s,n=i;for(D(r,e,s,t),e[2*i+o]>l&&D(r,e,s,i);a<n;){for(D(r,e,a,n),a++,n--;e[2*a+o]<l;)a++;for(;e[2*n+o]>l;)n--}e[2*s+o]===l?D(r,e,s,n):(n++,D(r,e,n,i)),n<=t&&(s=n+1),t<=n&&(i=n-1)}}function D(r,e,t,s){J(r,t,s),J(e,2*t,2*s),J(e,2*t+1,2*s+1)}function J(r,e,t){const s=r[e];r[e]=r[t],r[t]=s}function re(r,e,t,s){const i=r-t,o=e-s;return i*i+o*o}const Le={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:r=>r},oe=Math.fround||(r=>(e=>(r[0]=+e,r[0])))(new Float32Array(1)),I=2,O=3,Y=4,C=5,he=6;class Te{constructor(e){this.options=Object.assign(Object.create(Le),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:s,maxZoom:i}=this.options;t&&console.time("total time");const o=`prepare ${e.length} points`;t&&console.time(o),this.points=e;const l=[];for(let n=0;n<e.length;n++){const u=e[n];if(!u.geometry)continue;const[h,c]=u.geometry.coordinates,p=oe(H(h)),f=oe(K(c));l.push(p,f,1/0,n,-1,1),this.options.reduce&&l.push(0)}let a=this.trees[i+1]=this._createTree(l);t&&console.timeEnd(o);for(let n=i;n>=s;n--){const u=+Date.now();a=this.trees[n]=this._createTree(this._cluster(a,n)),t&&console.log("z%d: %d clusters in %dms",n,a.numItems,+Date.now()-u)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let s=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let o=e[2]===180?180:((e[2]+180)%360+360)%360-180;const l=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)s=-180,o=180;else if(s>o){const c=this.getClusters([s,i,180,l],t),p=this.getClusters([-180,i,o,l],t);return c.concat(p)}const a=this.trees[this._limitZoom(t)],n=a.range(H(s),K(l),H(o),K(i)),u=a.data,h=[];for(const c of n){const p=this.stride*c;h.push(u[p+C]>1?ae(u,p,this.clusterProps):this.points[u[p+O]])}return h}getChildren(e){const t=this._getOriginId(e),s=this._getOriginZoom(e),i="No cluster with the specified id.",o=this.trees[s];if(!o)throw new Error(i);const l=o.data;if(t*this.stride>=l.length)throw new Error(i);const a=this.options.radius/(this.options.extent*Math.pow(2,s-1)),n=l[t*this.stride],u=l[t*this.stride+1],h=o.within(n,u,a),c=[];for(const p of h){const f=p*this.stride;l[f+Y]===e&&c.push(l[f+C]>1?ae(l,f,this.clusterProps):this.points[l[f+O]])}if(c.length===0)throw new Error(i);return c}getLeaves(e,t,s){t=t||10,s=s||0;const i=[];return this._appendLeaves(i,e,t,s,0),i}getTile(e,t,s){const i=this.trees[this._limitZoom(e)],o=Math.pow(2,e),{extent:l,radius:a}=this.options,n=a/l,u=(s-n)/o,h=(s+1+n)/o,c={features:[]};return this._addTileFeatures(i.range((t-n)/o,u,(t+1+n)/o,h),i.data,t,s,o,c),t===0&&this._addTileFeatures(i.range(1-n/o,u,1,h),i.data,o,s,o,c),t===o-1&&this._addTileFeatures(i.range(0,u,n/o,h),i.data,-1,s,o,c),c.features.length?c:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const s=this.getChildren(e);if(t++,s.length!==1)break;e=s[0].properties.cluster_id}return t}_appendLeaves(e,t,s,i,o){const l=this.getChildren(t);for(const a of l){const n=a.properties;if(n&&n.cluster?o+n.point_count<=i?o+=n.point_count:o=this._appendLeaves(e,n.cluster_id,s,i,o):o<i?o++:e.push(a),e.length===s)break}return o}_createTree(e){const t=new Q(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let s=0;s<e.length;s+=this.stride)t.add(e[s],e[s+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,s,i,o,l){for(const a of e){const n=a*this.stride,u=t[n+C]>1;let h,c,p;if(u)h=de(t,n,this.clusterProps),c=t[n],p=t[n+1];else{const y=this.points[t[n+O]];h=y.properties;const[m,x]=y.geometry.coordinates;c=H(m),p=K(x)}const f={type:1,geometry:[[Math.round(this.options.extent*(c*o-s)),Math.round(this.options.extent*(p*o-i))]],tags:h};let M;u||this.options.generateId?M=t[n+O]:M=this.points[t[n+O]].id,M!==void 0&&(f.id=M),l.features.push(f)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:s,extent:i,reduce:o,minPoints:l}=this.options,a=s/(i*Math.pow(2,t)),n=e.data,u=[],h=this.stride;for(let c=0;c<n.length;c+=h){if(n[c+I]<=t)continue;n[c+I]=t;const p=n[c],f=n[c+1],M=e.within(n[c],n[c+1],a),y=n[c+C];let m=y;for(const x of M){const _=x*h;n[_+I]>t&&(m+=n[_+C])}if(m>y&&m>=l){let x=p*y,_=f*y,S,T=-1;const L=((c/h|0)<<5)+(t+1)+this.points.length;for(const Z of M){const N=Z*h;if(n[N+I]<=t)continue;n[N+I]=t;const U=n[N+C];x+=n[N]*U,_+=n[N+1]*U,n[N+Y]=L,o&&(S||(S=this._map(n,c,!0),T=this.clusterProps.length,this.clusterProps.push(S)),o(S,this._map(n,N)))}n[c+Y]=L,u.push(x/m,_/m,1/0,L,-1,m),o&&u.push(T)}else{for(let x=0;x<h;x++)u.push(n[c+x]);if(m>1)for(const x of M){const _=x*h;if(!(n[_+I]<=t)){n[_+I]=t;for(let S=0;S<h;S++)u.push(n[_+S])}}}}return u}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,s){if(e[t+C]>1){const l=this.clusterProps[e[t+he]];return s?Object.assign({},l):l}const i=this.points[e[t+O]].properties,o=this.options.map(i);return s&&o===i?Object.assign({},o):o}}function ae(r,e,t){return{type:"Feature",id:r[e+O],properties:de(r,e,t),geometry:{type:"Point",coordinates:[Ne(r[e]),Ce(r[e+1])]}}}function de(r,e,t){const s=r[e+C],i=s>=1e4?`${Math.round(s/1e3)}k`:s>=1e3?`${Math.round(s/100)/10}k`:s,o=r[e+he],l=o===-1?{}:Object.assign({},t[o]);return Object.assign(l,{cluster:!0,cluster_id:r[e+O],point_count:s,point_count_abbreviated:i})}function H(r){return r/360+.5}function K(r){const e=Math.sin(r*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Ne(r){return(r-.5)*360}function Ce(r){const e=(180-r*360)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}var le=Object.prototype.hasOwnProperty;function ce(r,e,t){for(t of r.keys())if(F(t,e))return t}function F(r,e){var t,s,i;if(r===e)return!0;if(r&&e&&(t=r.constructor)===e.constructor){if(t===Date)return r.getTime()===e.getTime();if(t===RegExp)return r.toString()===e.toString();if(t===Array){if((s=r.length)===e.length)for(;s--&&F(r[s],e[s]););return s===-1}if(t===Set){if(r.size!==e.size)return!1;for(s of r)if(i=s,i&&typeof i=="object"&&(i=ce(e,i),!i)||!e.has(i))return!1;return!0}if(t===Map){if(r.size!==e.size)return!1;for(s of r)if(i=s[0],i&&typeof i=="object"&&(i=ce(e,i),!i)||!F(s[1],e.get(i)))return!1;return!0}if(t===ArrayBuffer)r=new Uint8Array(r),e=new Uint8Array(e);else if(t===DataView){if((s=r.byteLength)===e.byteLength)for(;s--&&r.getInt8(s)===e.getInt8(s););return s===-1}if(ArrayBuffer.isView(r)){if((s=r.byteLength)===e.byteLength)for(;s--&&r[s]===e[s];);return s===-1}if(!t||typeof r=="object"){s=0;for(t in r)if(le.call(r,t)&&++s&&!le.call(e,t)||!(t in e)||!F(r[t],e[t]))return!1;return Object.keys(e).length===s}}return r!==r&&e!==e}function Oe(r){var e=E.useRef(r),t=E.useRef(0);return F(r,e.current)||(e.current=r,t.current+=1),E.useMemo(function(){return e.current},[t.current])}function Pe(r,e){return E.useEffect(r,Oe(e))}var Ie=function(e){var t=e.points,s=e.bounds,i=e.zoom,o=e.options,l=e.disableRefresh,a=E.useRef(),n=E.useRef(),u=E.useState([]),h=u[0],c=u[1],p=Math.round(i);return Pe(function(){l!==!0&&((!a.current||!F(n.current,t)||!F(a.current.options,o))&&(a.current=new Te(o),a.current.load(t)),s&&c(a.current.getClusters(s,p)),n.current=t)},[t,s,p,o,l]),{clusters:h,supercluster:a.current}};const Fe=r=>{const e=ge.c(25),{galleryColors:t,legendToggleRef:s,setIsLegendOpen:i,isLegendOpen:o,legendRef:l,theme:a,galleries:n,hiddenGalleries:u,handleLegendToggle:h,showWalks:c,setShowWalks:p}=r;let f;e[0]!==o||e[1]!==i?(f=()=>i(!o),e[0]=o,e[1]=i,e[2]=f):f=e[2];const M=a==="dark"?"bg-black text-white":"bg-white text-black";let y;e[3]!==M?(y=z("border gap-2 z-50 absolute top-4 right-4 p-2 flex items-center",M),e[3]=M,e[4]=y):y=e[4];let m,x;e[5]===Symbol.for("react.memo_cache_sentinel")?(m=d.jsx("span",{className:"text-xs ml-1",children:"Legende"}),x=d.jsx(ve,{size:16}),e[5]=m,e[6]=x):(m=e[5],x=e[6]);let _;e[7]!==s||e[8]!==f||e[9]!==y?(_=d.jsxs("button",{ref:s,onClick:f,className:y,"aria-label":"Legende Ein- oder Ausschalten",children:[m,x]}),e[7]=s,e[8]=f,e[9]=y,e[10]=_):_=e[10];let S;e[11]!==n||e[12]!==t||e[13]!==h||e[14]!==u||e[15]!==o||e[16]!==l||e[17]!==i||e[18]!==p||e[19]!==c||e[20]!==a?(S=o&&d.jsxs("div",{ref:l,className:z("border z-[100000] absolute top-12 right-4 p-4 w-[calc(100%-2rem)] max-h-[60vh] overflow-y-auto md:w-auto md:max-w-lg",a==="dark"?"bg-black text-white":"bg-white text-black"),children:[d.jsx("button",{onClick:()=>i(!1),className:"absolute top-2 right-2 p-1","aria-label":"Legende schließen",children:d.jsx(ee,{className:"h-4 w-4"})}),d.jsx("h3",{className:"font-bold text-lg mb-2",children:"Legende"}),d.jsx("h4",{className:"text-[11px] mb-4 opacity-90",children:"Fotoserie via Farbe, Klick auf Galerie um zu verstecken oder einzublenden"}),d.jsx("ul",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-2 text-sm mb-4",children:n.map(L=>d.jsxs("li",{className:`group flex items-center justify-between gap-2 cursor-pointer transition-opacity ${u.has(L.slug)?"opacity-50 hover:opacity-100":""}`,onClick:()=>h(L.slug),children:[d.jsxs("div",{className:"flex items-center gap-2 truncate",children:[d.jsx("div",{className:z(`w-3 h-3 min-w-3 min-h-3 flex-shrink-0 border ${t.get(L.slug)}`,a==="dark"?"border-white":"border-black")}),d.jsx("span",{className:"truncate text-xs",children:L.title})]}),d.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:u.has(L.slug)?d.jsx(Ae,{size:12}):d.jsx(ee,{size:12})})]},L.slug))}),d.jsxs("div",{className:z("border-t pt-4 mt-4",a==="dark"?"border-neutral-700":"border-neutral-300"),children:[d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:c,onChange:L=>p(L.target.checked),className:"cursor-pointer"}),d.jsx("span",{className:"text-sm",children:"Spaziergänge anzeigen"})]}),d.jsx("p",{className:"text-[11px] mt-1 opacity-70",children:"Zeigt Linien zwischen Fotos, die am selben Tag aufgenommen wurden (max. 1h Abstand)"})]})]}),e[11]=n,e[12]=t,e[13]=h,e[14]=u,e[15]=o,e[16]=l,e[17]=i,e[18]=p,e[19]=c,e[20]=a,e[21]=S):S=e[21];let T;return e[22]!==_||e[23]!==S?(T=d.jsxs(d.Fragment,{children:[_,S]}),e[22]=_,e[23]=S,e[24]=T):T=e[24],T};function Re(r){return r.properties.cluster===!0}const He=()=>{const r=E.useRef(null),{theme:e}=me(),[t,s]=E.useState(null),[i,o]=E.useState(!1),l=E.useRef(null),a=E.useRef(null),[n,u]=E.useState(new Set),[h,c]=E.useState(!1),[p,f]=E.useState(),[M]=ye(),[y,m]=E.useState({longitude:16,latitude:48,zoom:3}),x=E.useMemo(()=>{const g=[];return R.forEach(j=>{n.has(j.slug)||j.images?.forEach((w,k)=>{w.latitude&&w.longitude&&g.push({image:{...w,index:k},gallery:j})})}),g},[n]),_=E.useMemo(()=>["#fda4af","#fecdd3","#f0abfc","#f5d0fe","#a5b4fc","#c7d2fe","#7dd3fc","#bae6fd","#6ee7b7","#a7f3d0","#fcd34d","#fde68a","#fca5a5","#fecaca","#c4b5fd","#ddd6fe","#67e8f9","#a5f3fc","#bef264","#d9f99d","#f9a8d4","#fbcfe8","#93c5fd","#bfdbfe","#86efac","#bbf7d0","#fde047","#fef08a","#c084fc","#d8b4fe","#5eead4","#99f6e4"],[]),S=E.useMemo(()=>{const g=["bg-rose-300","bg-rose-200","bg-fuchsia-300","bg-fuchsia-200","bg-indigo-300","bg-indigo-200","bg-sky-300","bg-sky-200","bg-emerald-300","bg-emerald-200","bg-amber-300","bg-amber-200","bg-red-300","bg-red-200","bg-violet-300","bg-violet-200","bg-cyan-300","bg-cyan-200","bg-lime-300","bg-lime-200","bg-pink-300","bg-pink-200","bg-blue-300","bg-blue-200","bg-green-300","bg-green-200","bg-yellow-300","bg-yellow-200","bg-purple-300","bg-purple-200","bg-teal-300","bg-teal-200"],j=new Map;return R.forEach((w,k)=>{j.set(w.slug,g[k%g.length])}),j},[]),T=E.useMemo(()=>x.map(g=>({type:"Feature",properties:g,geometry:{type:"Point",coordinates:[g.image.longitude,g.image.latitude]}})),[x]);E.useEffect(()=>{if(t&&r.current){const g=r.current.getMap(),j=()=>{if(r.current){const w=g.getBounds();f(w?.toArray().flat())}g.off("idle",j)};g.on("idle",j)}},[t]),E.useEffect(()=>{const g=j=>{a.current&&!a.current.contains(j.target)&&l.current&&!l.current.contains(j.target)&&o(!1)};return i?document.addEventListener("mousedown",g):document.removeEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[i]);const{clusters:L,supercluster:Z}=Ie({points:T,bounds:p,zoom:y.zoom,options:{radius:75,maxZoom:11}}),N=E.useCallback(()=>{if(!r.current)return;const g=M.get("image"),j=M.get("gallery");if(g&&j){let w;const k=R.find(b=>b.slug===j);if(k){const b=k.images?.find(A=>te(A.filename.replace(/\.[^/.]+$/,""))===g);b&&b.latitude&&b.longitude&&(w={image:b,gallery:k})}w&&w.image.latitude&&w.image.longitude&&(m({...y,latitude:w.image.latitude,longitude:w.image.longitude,zoom:15}),s(w))}else{if(x.length===0)return;if(x.length===1)m({longitude:x[0].image.longitude,latitude:x[0].image.latitude,zoom:10});else{const w=x.map(B=>B.image.longitude),k=x.map(B=>B.image.latitude),b=Math.min(...w),A=Math.max(...w),v=Math.min(...k),P=Math.max(...k);r.current.fitBounds([[b,v],[A,P]],{padding:80,duration:1e3})}}},[x,M]),U=E.useCallback(g=>{u(j=>{const w=new Set(j);return w.has(g)?w.delete(g):w.add(g),w})},[]),W=E.useMemo(()=>{if(!h)return null;const g=[];R.forEach(b=>{b.images?.forEach(A=>{if(A.latitude&&A.longitude){const v=xe(A.createDate);v&&g.push({image:A,gallery:b,date:v})}})});const j=new Map;g.forEach(b=>{const A=b.date.toISOString().split("T")[0];j.has(A)||j.set(A,[]),j.get(A).push(b)});const w=[];let k=0;return j.forEach(b=>{b.sort((v,P)=>v.date.getTime()-P.date.getTime());let A=[b[0]];for(let v=1;v<b.length;v++)if((b[v].date.getTime()-b[v-1].date.getTime())/(1e3*60*60)<=1)A.push(b[v]);else{if(A.length>1){const pe=_[k%_.length];w.push({type:"Feature",geometry:{type:"LineString",coordinates:A.map(X=>[X.image.longitude,X.image.latitude])},properties:{color:pe}}),k++}A=[b[v]]}if(A.length>1){const v=_[k%_.length];w.push({type:"Feature",geometry:{type:"LineString",coordinates:A.map(P=>[P.image.longitude,P.image.latitude])},properties:{color:v}}),k++}}),{type:"FeatureCollection",features:w}},[h,_]);return d.jsxs("div",{className:"w-full h-full md:h-screen relative overflow-hidden",children:[d.jsx(ke,{title:`Foto Karte | ${G.meta.title}`,description:"Eine interaktive Karte mit allen Fotos, die Geodaten enthalten.",imageUrl:se("all",R[0].images[0].filename.replaceAll(" ","_"),1440)}),d.jsx(Fe,{galleryColors:S,legendToggleRef:a,setIsLegendOpen:o,isLegendOpen:i,legendRef:l,theme:e,galleries:R,hiddenGalleries:n,handleLegendToggle:U,showWalks:h,setShowWalks:c}),d.jsxs(be,{...y,onMove:g=>{m(g.viewState),r.current&&f(r.current.getMap().getBounds()?.toArray().flat())},ref:r,style:{width:"100%",height:"100%"},mapStyle:e==="dark"?G.mapbox.style.dark:G.mapbox.style.light,mapboxAccessToken:G.mapbox.accessToken,onLoad:N,children:[W&&W.features.length>0&&d.jsx(_e,{id:"walks",type:"geojson",data:W,children:d.jsx(je,{id:"walks-line",type:"line",paint:{"line-color":["get","color"],"line-width":2,"line-opacity":.7}})}),L.map(g=>{const[j,w]=g.geometry.coordinates;if(Re(g)){const{point_count:b,cluster_id:A}=g.properties;return d.jsx(ne,{latitude:w,longitude:j,children:d.jsx("div",{className:`shadow-[-2px_0px_0px_#00000033] -rotate-45 ${e==="dark"?"bg-white text-black":"bg-black text-white"} border flex items-center justify-center cursor-pointer`,style:{width:`${30+b/T.length*40}px`,height:`${30+b/T.length*40}px`},onClick:()=>{if(!Z)return;const v=Math.min(Z.getClusterExpansionZoom(A),20);m({...y,longitude:j,latitude:w,zoom:v})},children:d.jsx("span",{className:"rotate-45",children:b})})},`cluster-${A}`)}const k=g.properties;return d.jsx(ne,{longitude:k.image.longitude,latitude:k.image.latitude,anchor:"center",onClick:b=>{b.originalEvent?.stopPropagation(),s(k)},children:d.jsx("div",{className:z(`shadow-[1px_1px_0px_#00000033] h-3 w-3 border ${S.get(k.gallery.slug)||"bg-gray-400"} ${e==="dark"?"border-white":"border-gray-800"}`)})},`marker-${k.image.filename}`)}),t&&d.jsx(Me,{anchor:"top",longitude:Number(t.image.longitude),latitude:Number(t.image.latitude),onClose:()=>s(null),closeButton:!1,className:"z-10 ",children:d.jsxs(we,{to:`/gallery/${t.gallery.slug}/image/${te(t.image.filename.replace(/\.[^/.]+$/,""))}`,children:[d.jsxs("div",{className:"relative bg-[white] text-black",children:[d.jsx("div",{className:"relative group ",children:d.jsx("img",{className:"w-40 md:w-64 w-full h-auto",src:se(t.gallery.slug,t.image.filename.replaceAll(" ","_"),380),alt:t.image.alt||t.image.filename.replaceAll("_"," ").replace(".jpg",""),loading:"lazy"})}),d.jsx("section",{className:"flex items-start justify-between gap-2",children:d.jsxs("div",{className:z("font-geist p-2 pt-4 text-base truncate"),children:[d.jsx("p",{className:"text-sm truncate",children:t.image.filename.replaceAll("_"," ").replace(".jpg","")}),d.jsx(Ee,{to:`/gallery/${t.gallery.slug}`,className:"text-[11px] truncate !text-black",children:t.gallery.title})]})})]})," "]})})]})]})};export{He as default};
